<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 21. Email</title><link rel="stylesheet" href="css/seamframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Seam - Contextual Components"/><link rel="up" href="index.html" title="Seam - Contextual Components"/><link rel="prev" href="rss.html" title="Chapter 20. RSS support"/><link rel="next" href="jms.html" title="Chapter 22. Asynchronicity and messaging"/></head><body><p id="title"><a href="http://www.seamframework.org" class="site_href"><strong>SeamFramework.org</strong></a><a href="http://www.seamframework.org/Documentation" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="rss.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="jms.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mail"/>Chapter 21. Email</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="mail.html#d0e20280">21.1. Creating a message</a></span></dt><dd><dl><dt><span class="section"><a href="mail.html#d0e20321">21.1.1. Attachments</a></span></dt><dt><span class="section"><a href="mail.html#d0e20399">21.1.2. HTML/Text alternative part</a></span></dt><dt><span class="section"><a href="mail.html#d0e20406">21.1.3. Multiple recipients</a></span></dt><dt><span class="section"><a href="mail.html#d0e20416">21.1.4. Multiple messages</a></span></dt><dt><span class="section"><a href="mail.html#d0e20426">21.1.5. Templating</a></span></dt><dt><span class="section"><a href="mail.html#d0e20461">21.1.6. Internationalisation</a></span></dt><dt><span class="section"><a href="mail.html#d0e20472">21.1.7. Other Headers</a></span></dt></dl></dd><dt><span class="section"><a href="mail.html#d0e20488">21.2. Receiving emails</a></span></dt><dt><span class="section"><a href="mail.html#d0e20535">21.3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="mail.html#d0e20560">21.3.1. mailSession</a></span></dt></dl></dd><dt><span class="section"><a href="mail.html#mail.tags">21.4. Tags</a></span></dt></dl></div><p>
    Seam now includes an optional components for templating and sending emails.
  </p><p>
    Email support is provided by <code class="literal">jboss-seam-mail.jar</code>. This 
    JAR contains the mail JSF controls, which are used to construct emails,
    and the <code class="literal">mailSession</code> manager component. 
  </p><p>
    The examples/mail project contains an example of the email support in 
    action. It demonstrates proper packaging, and it contains a number of 
    example that demonstrate the key features currently supported. 
  </p><p>
    You can also test your mail's using Seam's integration testing environment.
    See <a class="xref" href="testing.html#testing.mail" title="37.2.3.4. Integration Testing Seam Mail">Section 37.2.3.4, “Integration Testing Seam Mail”</a>.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e20280"/>21.1. Creating a message</h2></div></div></div><p>
      You don't need to learn a whole new templating language to use Seam Mail 
      — an email is just facelet!
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:message</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:m</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/mail&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:h</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/jsf/html&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:from</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Peter&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">address</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;peter@example.com&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:to</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.firstname}&nbsp;#{person.lastname}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{person.address}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:to</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:subject</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Try&nbsp;out&nbsp;Seam!</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:subject</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;&lt;</span><span class="xml_tag_name">h:outputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Dear&nbsp;#{person.firstname}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">,</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">You&nbsp;can&nbsp;try&nbsp;out&nbsp;Seam&nbsp;by&nbsp;visiting&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">a</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://labs.jboss.com/jbossseam&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">http://labs.jboss.com/jbossseam</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">a</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">.</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Regards,</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Pete</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
      The <code class="literal">&lt;m:message&gt;</code> tag wraps the whole message, 
      and tells Seam to start rendering an email.  Inside the <code class="literal">&lt;m:message&gt;</code>
      tag we use an <code class="literal">&lt;m:from&gt;</code> tag to set who the 
      message is from, a <code class="literal">&lt;m:to&gt;</code> tag to	specify a 
      sender (notice how we use EL as we would in a normal facelet), and a 
      <code class="literal">&lt;m:subject&gt;</code> tag.
    </p><p>
      The <code class="literal">&lt;m:body&gt;</code> tag wraps the body of the email. 
      You can use regular HTML tags inside the body as well as JSF components.
    </p><p>
      So, now you have your email template, how do you go about sending it? 
      Well, at the end of rendering the <code class="literal">m:message</code> the 
      <code class="literal">mailSession</code> is called to send the email, so all you 
      have to do is ask Seam to render the view:
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">In</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">create</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">true</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Renderer</span><span class="java_plain">&nbsp;renderer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;send</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderer</span><span class="java_separator">.</span><span class="java_plain">render</span><span class="java_separator">(</span><span class="java_literal">&quot;/simple.xhtml&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;facesMessages</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_literal">&quot;Email&nbsp;sent&nbsp;successfully&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;facesMessages</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_literal">&quot;Email&nbsp;sending&nbsp;failed:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;e</span><span class="java_separator">.</span><span class="java_plain">getMessage</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
      If, for example, you entered an invalid email address, then an exception 
      would be thrown, which is caught and then displayed to the user.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20321"/>21.1.1. Attachments</h3></div></div></div><p>
        Seam makes it easy to attach files to an email.  It supports most of 
        the standard java types used when working with files.
      </p><p>
        If you wanted to email the <code class="literal">jboss-seam-mail.jar</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:attachment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/WEB-INF/lib/jboss-seam-mail.jar&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Seam will load the file from the classpath, and attach it to the email.
        By default it would be attached as <code class="literal">jboss-seam-mail.jar</code>;
   		if you wanted it to have another name you would just add the <code class="literal">fileName</code> attribute:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:attachment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/WEB-INF/lib/jboss-seam-mail.jar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">fileName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;this-is-so-cool.jar&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        You could also attach a <code class="literal">java.io.File</code>, a <code class="literal">java.net.URL</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:attachment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{numbers}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Or a <code class="literal">byte[]</code> or a <code class="literal">java.io.InputStream</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:attachment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.photo}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">contentType</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;image/png&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        You'll notice that for a <code class="literal">byte[]</code> and a <code class="literal">java.io.InputStream</code>
        you need to specify the MIME type of the attachment (as that 
        information is not carried as part of the file).
      </p><p>
        And it gets even better, you can attach a Seam generated PDF, or any 
        standard JSF view, just by wrapping a <code class="literal">&lt;m:attachment&gt;</code> 
        around the normal tags you would use:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:attachment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">fileName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;tiny.pdf&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">p:document</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;very&nbsp;tiny&nbsp;PDF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">p:document</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:attachment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        If you had a set of files you wanted to attach (for example a set of 
        pictures loaded from a database) you can just use a <code class="literal">&lt;ui:repeat&gt;</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:repeat</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{people}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">var</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;person&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:attachment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.photo}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">contentType</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;image/jpeg&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">fileName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.firstname}_#{person.lastname}.jpg&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ui:repeat</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        And if you want to display an attached image inline:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:attachment</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.photo}&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">contentType</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;image/jpeg&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">fileName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.firstname}_#{person.lastname}.jpg&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">status</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;personPhoto&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">disposition</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;inline&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">img</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">src</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cid:#{personPhoto.contentId}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        You may be wondering what <code class="literal">cid:#{...}</code> does. Well, the
        IETF specified that by putting this as the src for your image, the 
        attachments will be looked at when trying to locate the image (the 
        <code class="literal">Content-ID</code>'s must match) — magic!
      </p><p>
        You must declare the attachment before trying to access the status object.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20399"/>21.1.2. HTML/Text alternative part</h3></div></div></div><p>
        Whilst most mail readers nowadays support HTML, some don't, so you can 
        add a plain text alternative to your email body:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">f:facet</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;alternative&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Sorry,&nbsp;your&nbsp;email&nbsp;reader&nbsp;can't&nbsp;show&nbsp;our&nbsp;fancy&nbsp;email,&nbsp;</span><br />
<span class="xml_plain">please&nbsp;go&nbsp;to&nbsp;http://labs.jboss.com/jbossseam&nbsp;to&nbsp;explore&nbsp;Seam.</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">f:facet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20406"/>21.1.3. Multiple recipients</h3></div></div></div><p>
        Often you'll want to send an email to a group of recipients (for 
        example your users).  All of the recipient mail tags can be placed 
        inside a <code class="literal">&lt;ui:repeat&gt;</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:repeat</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{allUsers}&nbsp;var=&quot;</span><span class="xml_attribute_name">user</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">m:to</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{user.firstname}&nbsp;#{user.lastname}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">address</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{user.emailAddress}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ui:repeat</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20416"/>21.1.4. Multiple messages</h3></div></div></div><p>
        Sometimes, however, you need to send a slightly different message to 
        each recipient (e.g. a password	reset).  The best way to do this is to 
        place the whole message inside a <code class="literal">&lt;ui:repeat&gt;</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:repeat</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{people}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">var</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;p&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:from</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.firstname}&nbsp;#{person.lastname}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{person.address}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:to</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{p.firstname}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{p.address}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:to</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ui:repeat</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20426"/>21.1.5. Templating</h3></div></div></div><p>
        The mail templating example shows that facelets templating just works 
        with the Seam mail tags.
      </p><p>
        Our <code class="literal">template.xhtml</code> contains:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:from</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Seam&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">address</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;do-not-reply@jboss.com&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:to</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{person.firstname}&nbsp;#{person.lastname}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{person.address}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:to</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:subject</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{subject}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:subject</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">html</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:insert</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;body&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">This&nbsp;is&nbsp;the&nbsp;default&nbsp;body,&nbsp;specified&nbsp;by&nbsp;the&nbsp;template.</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ui:insert</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">html</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Our <code class="literal">templating.xhtml</code> contains:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;subject&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Templating&nbsp;with&nbsp;Seam&nbsp;Mail&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:define</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;body&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">This&nbsp;example&nbsp;demonstrates&nbsp;that&nbsp;you&nbsp;can&nbsp;easily&nbsp;use&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">i</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">facelets&nbsp;templating</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">i</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;in&nbsp;email!</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ui:define</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        You can also use facelets source tags in your email, but you must place
        them in a jar in <code class="literal">WEB-INF/lib</code> - referencing the 
        <code class="literal">.taglib.xml</code> from <code class="literal">web.xml</code> isn't 
        reliable when using Seam Mail (if you send your mail asynchronously 
        Seam Mail doesn't have access to the full JSF or Servlet context, and 
        so doesn't know about <code class="literal">web.xml</code> configuration 
        parameters).
      </p><p>
        If you do need more configure Facelets or JSF when sending mail, you'll
        need to override the Renderer component and do the configuration 
        programmatically - only for advanced users!
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20461"/>21.1.6. Internationalisation</h3></div></div></div><p>
        Seam supports sending internationalised messages.  By default, the 
        encoding provided by JSF is used, but this can be overridden on the 
        template:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:message</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">charset</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;UTF-8&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">m:message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        The body, subject and recipient (and from) name will be encoded.  
        You'll need to make sure facelets uses the correct charset for parsing
        your pages by setting encoding of the template:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20472"/>21.1.7. Other Headers</h3></div></div></div><p>
        Sometimes you'll want to add other headers to your email.  Seam 
        provides support for some (see <a class="xref" href="mail.html#mail.tags" title="21.4. Tags">Section 21.4, “Tags”</a>). For 
        example, we can set the importance of the email, and ask for a read 
        receipt:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:message</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns:m</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/mail&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">importance</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;low&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">requestReadReceipt</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Otherwise you can add any header to the message using the 
        <code class="literal">&lt;m:header&gt;</code> tag:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">m:header</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;X-Sent-From&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JBoss&nbsp;Seam&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e20488"/>21.2. Receiving emails</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2>Please be reminded that this section is not updated for JBoss AS 7.x!</div><p>
      If you are using EJB then you can use a MDB (Message Driven Bean) to 
      receive email.  JBoss provides a JCA adaptor — 
      <code class="literal">mail-ra.rar</code> — but the version distributed with
      JBoss AS 4.x has a number of limitations (and isn't bundled in some versions)
      therefore we recommend using the <code class="literal">mail-ra.rar</code> 
      distributed with Seam (it's in the <code class="literal">extras/</code>
      directory in the Seam bundle).  <code class="literal">mail-ra.rar</code> should 
      be placed in <code class="literal">$JBOSS_HOME/server/default/deploy</code>; if the
      version of JBoss AS you use already has this file, replace it.
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>JBoss AS 5.x and newer has mail-ra.rar applied the patches,
    	 so there is no need to copy the mail-ra.rar from Seam distribution.</p></div><p>
      You can configure it like this:
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">MessageDriven</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">activationConfig</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;mailServer&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;localhost&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;mailFolder&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;INBOX&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;storeProtocol&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;pop3&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;userName&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;seam&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;password&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;seam&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ResourceAdapter</span><span class="java_separator">(</span><span class="java_literal">&quot;mail-ra.rar&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Name</span><span class="java_separator">(</span><span class="java_literal">&quot;mailListener&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MailListenerMDB</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">MailListener</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_separator">(</span><span class="java_plain">create</span><span class="java_operator">=</span><span class="java_literal">true</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">OrderProcessor</span><span class="java_plain">&nbsp;orderProcessor</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;onMessage</span><span class="java_separator">(</span><span class="java_type">Message</span><span class="java_plain">&nbsp;message</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Process</span><span class="java_plain">&nbsp;the&nbsp;message</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orderProcessor</span><span class="java_separator">.</span><span class="java_plain">process</span><span class="java_separator">(</span><span class="java_plain">message</span><span class="java_separator">.</span><span class="java_plain">getSubject</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
      Each message received will cause <code class="literal">onMessage(Message message)</code> 
      to be called.  Most Seam annotations will work inside a MDB but you 
      must not access the persistence context.
    </p><p>
      You can find more information on <code class="literal">mail-ra.rar</code>
      at <a class="ulink" href="http://www.jboss.org/community/wiki/InboundJavaMail">http://www.jboss.org/community/wiki/InboundJavaMail</a>.
    </p><p>
      If you aren't using JBoss AS you can still use <code class="literal">mail-ra.rar</code> 
      or you may find your application server includes a similar adapter.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e20535"/>21.3. Configuration</h2></div></div></div><p>
      To include Email support in your application, include <code class="literal">jboss-seam-mail.jar</code>
      in your <code class="literal">WEB-INF/lib</code> directory. If you are using JBoss 
      AS there is no further configuration needed to use Seam's email support.
      Otherwise you need to make sure you have the JavaMail API, an 
      implementation of the JavaMail API present (the API and impl used in 
      JBoss AS are distributed with seam as <code class="literal">lib/mail.jar</code>),
      and a copy of the Java Activation Framework (distributed with Seam as 
      <code class="literal">lib/activation.jar</code>.
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
         The Seam Mail module requires the use of Facelets as the view 
         technology. This is the default View technology in JSF 2. 
         Additionally, it requires the use of the jboss-seam-ui module.
      </p></div><p>
      The <code class="literal">mailSession</code> component uses JavaMail to talk to a 
      'real' SMTP server.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20560"/>21.3.1. <code class="literal">mailSession</code></h3></div></div></div><p>
        A JavaMail Session may be available via a JNDI lookup if you are 
        working in an JEE environment or you can use a Seam configured Session.
      </p><p>
        The mailSession component's properties are described in more detail in 
        <a class="xref" href="components.html#components.mail" title="32.9. Mail-related components">Section 32.9, “Mail-related components”</a>.
      </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e20570"/>21.3.1.1. JNDI lookup in JBoss AS</h4></div></div></div><p>
          The JBoss AS 7 Mail service is defined in <code class="filename">standalone/configuration/standalone.xml</code> file. It configures a 
          JavaMail session binding into JNDI.  The default service 
          configuration will need altering for your network.  
          <a class="ulink" href="http://www.mastertheboss.com/jboss-application-server/379-jboss-mail-service-configuration.html">Full article how to configure Mail system in JBoss AS 7</a>
          describes the service in more detail.
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">components</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/components&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:core</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/core&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:mail</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/mail&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">mail:mail-session</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">session-jndi-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;java:jboss/mail/Default&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">components</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
          Here we tell Seam to get the mail session bound to 
          <code class="literal">java:jboss/mail/Default</code> from JNDI.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e20588"/>21.3.1.2. Seam configured Session</h4></div></div></div><p>
          A mail session can be configured via <code class="literal">components.xml</code>.
          Here we tell Seam to use <code class="literal">smtp.example.com</code> as the 
          smtp server:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">components</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/components&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:core</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/core&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:mail</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/mail&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">mail:mail-session</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">host</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;smtp.example.com&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">components</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mail.tags"/>21.4. Tags</h2></div></div></div><p>
      Emails are generated using tags in the <code class="literal">http://jboss.org/schema/seam/mail</code>
      namespace. Documents should always have the <code class="literal">message</code>
      tag at the root of the message. The message tag prepares Seam to generate
      an email.
    </p><p>
      The standard templating tags of facelets can be used as normal. Inside
      the body you can use any JSF tag; if it  requires access to external 
      resources (stylesheets, javascript) then be sure to set the 
      <code class="literal">urlBase</code>.
    </p><div class="variablelist"><dl><dt><span class="term">&lt;m:message&gt;</span></dt><dd><p>
	        Root tag of a mail message
	      </p><div class="itemizedlist"><ul><li><p>
	            <code class="literal">importance</code> — low, normal or high.  By
                default normal, this sets the importance of the mail message.
              </p></li><li><p>
                <code class="literal">precedence</code> — sets the precedence of
                the message (e.g. bulk).
              </p></li><li><p>
                <code class="literal">requestReadReceipt</code> — by default false,
                if set, a read receipt request will be will be added, with the
                read receipt being sent to the <code class="literal">From:</code>
                address.
              </p></li><li><p>
                <code class="literal">urlBase</code> — If set, the value is
                prepended to the <code class="literal">requestContextPath</code> allowing
                you to use components such as
                <code class="literal">&lt;h:graphicImage&gt;</code> in your emails.
              </p></li><li><p>
                <code class="literal">messageId</code> — Sets the Message-ID explicitly
              </p></li></ul></div></dd><dt><span class="term">&lt;m:from&gt;</span></dt><dd><p>
            Set's the From: address for the email.  You can only have one of 
            these per email.
          </p><div class="itemizedlist"><ul><li><p>
                <code class="literal">name</code> — the name the email should come
                from.
              </p></li><li><p>
                <code class="literal">address</code> — the email address the email
                should come from.
              </p></li></ul></div></dd><dt><span class="term">&lt;m:replyTo&gt;</span></dt><dd><p>
              Set's the Reply-to: address for the email.  You can only have one
              of these per email.
            </p><div class="itemizedlist"><ul><li><p>
                 <code class="literal">address</code> — the email address the email
                 should come from.
               </p></li></ul></div></dd><dt><span class="term">&lt;m:to&gt;</span></dt><dd><p>
            Add a recipient to the email. Use multiple &lt;m:to&gt; tags for
            multiple recipients. This tag can be safely placed inside a repeat 
            tag such as &lt;ui:repeat&gt;.
        </p><div class="itemizedlist"><ul><li><p>
                <code class="literal">name</code> — the name of the recipient.
              </p></li><li><p>
                <code class="literal">address</code> — the email address of the recipient.
              </p></li></ul></div></dd><dt><span class="term">&lt;m:cc&gt;</span></dt><dd><p>
              Add a cc recipient to the email. Use multiple &lt;m:cc&gt; tags
              for multiple ccs. This tag can be safely placed inside a iterator
              tag such as &lt;ui:repeat&gt;.
            </p><div class="itemizedlist"><ul><li><p>
                  <code class="literal">name</code> — the name of the recipient.
                </p></li><li><p>
                  <code class="literal">address</code> —  the email address of the
                  recipient.
                </p></li></ul></div></dd><dt><span class="term">&lt;m:bcc&gt;</span></dt><dd><p>
              Add a bcc recipient to the email. Use multiple &lt;m:bcc&gt; 
              tags for multiple bccs. This tag can be safely placed inside a
              repeat tag such as &lt;ui:repeat&gt;.
            </p><div class="itemizedlist"><ul><li><p>
                  <code class="literal">name</code> — the name of the recipient.
                </p></li><li><p>
                  <code class="literal">address</code> — the email address of the
                  recipient.
                </p></li></ul></div></dd><dt><span class="term">&lt;m:header&gt;</span></dt><dd><p>
              Add a header to the email (e.g. <code class="literal">X-Sent-From: JBoss Seam</code>)
            </p><div class="itemizedlist"><ul><li><p>
                  <code class="literal">name</code> — The name of the header to 
                  add (e.g. <code class="literal">X-Sent-From</code>).
                </p></li><li><p>
                  <code class="literal">value</code> — The value of the header to
                  add (e.g. <code class="literal">JBoss Seam</code>).
                </p></li></ul></div></dd><dt><span class="term">&lt;m:attachment&gt;</span></dt><dd><p>
            Add an attachment to the email.
          </p><div class="itemizedlist"><ul><li><p>
                <code class="literal">value</code> — The file to attach:
              </p><div class="itemizedlist"><ul><li><p>
                    <code class="literal">String</code> — A <code class="literal">String</code>
                     is interpreted as a path to file within the classpath
                  </p></li><li><p>
                    <code class="literal">java.io.File</code> — An EL expression
                    can reference a <code class="literal">File</code> object
                  </p></li><li><p>
                   <code class="literal">java.net.URL</code> — An EL expression
                   can reference a <code class="literal">URL</code> object
                  </p></li><li><p>
                    <code class="literal">java.io.InputStream</code> — An EL 
                    expression can reference an <code class="literal">InputStream</code>. 
                    In this case both a <code class="literal">fileName</code> and a 
                    <code class="literal">contentType</code> must be specified.
                  </p></li><li><p>
                    <code class="literal">byte[]</code> — An EL expression can
                    reference an <code class="literal">byte[]</code>. In this case both
                    a <code class="literal">fileName</code> and a 
                    <code class="literal">contentType</code> must be specified.
                  </p></li></ul></div><p>If the value attribute is ommitted:</p><div class="itemizedlist"><ul><li><p>
                    If this tag contains a <code class="literal">&lt;p:document&gt;</code>
                    tag, the document described will be generated and 
                    attached to the email.  A <code class="literal">fileName</code>
                    should be specified.
                  </p></li><li><p>
                    If this tag contains other JSF tags a HTML document will 
                    be generated from them and attached to the email. A 
                    <code class="literal">fileName</code> should be specified.
                  </p></li></ul></div></li><li><p>
                <code class="literal">fileName</code> — Specify the file name to
                use for the attached file.
              </p></li><li><p>
                <code class="literal">contentType</code> — Specify the MIME type
                of the attached file
              </p></li></ul></div></dd><dt><span class="term">&lt;m:subject&gt;</span></dt><dd><p>
            Set's the subject for the email.
          </p></dd><dt><span class="term">&lt;m:body&gt;</span></dt><dd><p>
            Set's the body for the email.  Supports an <code class="literal">alternative</code>
            facet which, if an HTML email is generated can contain
            alternative text for a mail reader which doesn't support html.
          </p><div class="itemizedlist"><ul><li><p>
                <code class="literal">type</code> — If set to <code class="literal">plain</code>
                then a plain text email will be generated otherwise an HTML 
                email is generated.  
              </p></li></ul></div></dd></dl></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="rss.html"><strong>Prev</strong>Chapter 20. RSS support</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="jms.html"><strong>Next</strong>Chapter 22. Asynchronicity and messaging</a></li></ul></body></html>