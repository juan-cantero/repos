<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 15. Security</title><link rel="stylesheet" href="css/seamframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Seam - Contextual Components"/><link rel="up" href="index.html" title="Seam - Contextual Components"/><link rel="prev" href="drools.html" title="Chapter 14. Seam and JBoss Rules"/><link rel="next" href="i18n.html" title="Chapter 16. Internationalization, localization and themes"/></head><body><p id="title"><a href="http://www.seamframework.org" class="site_href"><strong>SeamFramework.org</strong></a><a href="http://www.seamframework.org/Documentation" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="drools.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="i18n.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="security"/>Chapter 15. Security</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="security.html#d0e8144">15.1. Overview</a></span></dt><dt><span class="sect1"><a href="security.html#d0e8170">15.2. Disabling Security</a></span></dt><dt><span class="sect1"><a href="security.html#d0e8196">15.3. Authentication</a></span></dt><dd><dl><dt><span class="sect2"><a href="security.html#d0e8201">15.3.1. Configuring an Authenticator component</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8231">15.3.2. Writing an authentication method</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8327">15.3.3. Writing a login form</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8351">15.3.4. Configuration Summary</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8369">15.3.5. Remember Me</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8448">15.3.6. Handling Security Exceptions</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8484">15.3.7. Login Redirection</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8506">15.3.8. HTTP Authentication</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8556">15.3.9. Advanced Authentication Features</a></span></dt></dl></dd><dt><span class="sect1"><a href="security.html#d0e8585">15.4. Identity Management</a></span></dt><dd><dl><dt><span class="sect2"><a href="security.html#d0e8606">15.4.1. Configuring IdentityManager</a></span></dt><dt><span class="sect2"><a href="security.html#d0e8677">15.4.2. JpaIdentityStore</a></span></dt><dt><span class="sect2"><a href="security.html#d0e9042">15.4.3. LdapIdentityStore</a></span></dt><dt><span class="sect2"><a href="security.html#d0e9574">15.4.4. Writing your own IdentityStore</a></span></dt><dt><span class="sect2"><a href="security.html#d0e9587">15.4.5. Authentication with Identity Management</a></span></dt><dt><span class="sect2"><a href="security.html#d0e9607">15.4.6. Using IdentityManager</a></span></dt></dl></dd><dt><span class="sect1"><a href="security.html#d0e10599">15.5. Error Messages</a></span></dt><dt><span class="sect1"><a href="security.html#d0e10682">15.6. Authorization</a></span></dt><dd><dl><dt><span class="sect2"><a href="security.html#d0e10690">15.6.1. Core concepts</a></span></dt><dt><span class="sect2"><a href="security.html#d0e10726">15.6.2. Securing components</a></span></dt><dt><span class="sect2"><a href="security.html#d0e10884">15.6.3. Security in the user interface</a></span></dt><dt><span class="sect2"><a href="security.html#d0e10927">15.6.4. Securing pages</a></span></dt><dt><span class="sect2"><a href="security.html#d0e10967">15.6.5. Securing Entities</a></span></dt><dt><span class="sect2"><a href="security.html#d0e11130">15.6.6. Typesafe Permission Annotations</a></span></dt><dt><span class="sect2"><a href="security.html#d0e11195">15.6.7. Typesafe Role Annotations</a></span></dt><dt><span class="sect2"><a href="security.html#d0e11219">15.6.8. The Permission Authorization Model</a></span></dt><dt><span class="sect2"><a href="security.html#d0e11477">15.6.9. RuleBasedPermissionResolver</a></span></dt><dt><span class="sect2"><a href="security.html#d0e11765">15.6.10. PersistentPermissionResolver</a></span></dt></dl></dd><dt><span class="sect1"><a href="security.html#d0e12566">15.7. Permission Management</a></span></dt><dd><dl><dt><span class="sect2"><a href="security.html#d0e12574">15.7.1. PermissionManager</a></span></dt><dt><span class="sect2"><a href="security.html#d0e12795">15.7.2. Permission checks for PermissionManager operations</a></span></dt></dl></dd><dt><span class="sect1"><a href="security.html#d0e12981">15.8. SSL Security</a></span></dt><dd><dl><dt><span class="sect2"><a href="security.html#d0e13051">15.8.1. Overriding the default ports</a></span></dt></dl></dd><dt><span class="sect1"><a href="security.html#d0e13070">15.9. CAPTCHA</a></span></dt><dd><dl><dt><span class="sect2"><a href="security.html#d0e13096">15.9.1. Configuring the CAPTCHA Servlet</a></span></dt><dt><span class="sect2"><a href="security.html#d0e13106">15.9.2. Adding a CAPTCHA to a form</a></span></dt><dt><span class="sect2"><a href="security.html#d0e13121">15.9.3. Customising the CAPTCHA algorithm</a></span></dt></dl></dd><dt><span class="sect1"><a href="security.html#d0e13128">15.10. Security Events</a></span></dt><dt><span class="sect1"><a href="security.html#d0e13294">15.11. Run As</a></span></dt><dt><span class="sect1"><a href="security.html#d0e13341">15.12. Extending the Identity component</a></span></dt><dt><span class="sect1"><a href="security.html#d0e13369">15.13. OpenID</a></span></dt><dd><dl><dt><span class="sect2"><a href="security.html#d0e13384">15.13.1. Configuring OpenID</a></span></dt><dt><span class="sect2"><a href="security.html#d0e13416">15.13.2. Presenting an OpenIdDLogin form</a></span></dt><dt><span class="sect2"><a href="security.html#d0e13440">15.13.3. Logging in immediately</a></span></dt><dt><span class="sect2"><a href="security.html#d0e13464">15.13.4. Deferring login</a></span></dt><dt><span class="sect2"><a href="security.html#d0e13478">15.13.5. Logging out</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8144"/>15.1. Overview</h2></div></div></div><p>
      The Seam Security API provides a multitude of security-related features for your Seam-based application, covering 
      such areas as:
    </p><div class="itemizedlist"><ul><li><p>
          Authentication - an extensible, JAAS-based authentication layer that allows users to authenticate
          against any security provider.
        </p></li><li><p>
          Identity Management - an API for managing a Seam application's users and roles at runtime.
        </p></li><li><p>
          Authorization - an extremely comprehensive authorization framework, supporting user roles, persistent and
          rule-based permissions, and a pluggable permission resolver for easily implementing customised security logic.
        </p></li><li><p>
          Permission Management - a set of built-in Seam components to allow easy management of an application's 
          security policy.
        </p></li><li><p>
          CAPTCHA support - to assist in the prevention of automated software/scripts abusing your Seam-based site.
        </p></li><li><p>
          And much more
        </p></li></ul></div><p>
      This chapter will cover each of these features in detail.
    </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8170"/>15.2. Disabling Security</h2></div></div></div><p>
      In some situations it may be necessary to disable Seam Security, for instances during unit tests or because you
      are using a different approach to security, such as native JAAS. Simply call the static method
      <code class="literal">Identity.setSecurityEnabled(false)</code> to disable the security infrastructure. Of course, it's not
      very convenient to have to call a static method when you want to configure the application, so as an alternative
      you can control this setting in components.xml:
    </p><div class="itemizedlist"><ul><li><p>Entity Security</p></li><li><p>Hibernate Security Interceptor</p></li><li><p>Seam Security Interceptor</p></li><li><p>Page restrictions</p></li><li><p>Servlet API security integration</p></li></ul></div><p>
      Assuming you are planning to take advantage of what Seam Security has to offer, the rest of this chapter documents
      the plethora of options you have for giving your user an identity in the eyes of the security model
      (authentication) and locking down the application by establishing constraints (authorization). Let's begin with
      the task of authentication since that's the foundation of any security model.
    </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8196"/>15.3. Authentication</h2></div></div></div><p>
      The authentication features provided by Seam Security are built upon JAAS (Java Authentication and Authorization Service),
      and as such provide a robust and highly configurable API for handling user authentication.  However, for less complex
      authentication requirements Seam offers a much more simplified method of authentication that hides the complexity of JAAS.
    </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8201"/>15.3.1. Configuring an Authenticator component</h3></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
          If you use Seam's Identity Management features (discussed later in this chapter) then it is not necessary to create
          an authenticator component (and you can skip this section).
        </p></div><p>
        The simplified authentication method provided by Seam uses a built-in JAAS login module, <code class="literal">SeamLoginModule</code>, which
        delegates authentication to one of your own Seam components.  This login module is already configured inside Seam as
        part of a default application policy and as such does not require any additional configuration files.  It allows you to
        write an authentication method using the entity classes that are provided by your own application, or alternatively to 
        authenticate with some other third party provider.  Configuring this simplified form of authentication requires the 
        <code class="literal">identity</code> component to be configured in <code class="literal">components.xml</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">components</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/components&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:core</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/core&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:security</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/security&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/components&nbsp;http://jboss.org/schema/seam/components-2.3.xsd</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://jboss.org/schema/seam/security&nbsp;http://jboss.org/schema/seam/security-2.3.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:identity</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">authenticate-method</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{authenticator.authenticate}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">components</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        The EL expression <code class="literal">#{authenticator.authenticate}</code> is a method binding that indicates
        the <code class="literal">authenticate</code> method of the <code class="literal">authenticator</code> component will be used
        to authenticate the user.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8231"/>15.3.2. Writing an authentication method</h3></div></div></div><p>
        The <code class="literal">authenticate-method</code> property specified for <code class="literal">identity</code> in
        <code class="literal">components.xml</code> specifies which method will be used by <code class="literal">SeamLoginModule</code>
        to authenticate users.  This method takes no parameters, and is expected to return a boolean, which indicates
        whether authentication is successful or not.  The user's username and password can be obtained from
        <code class="literal">Credentials.getUsername()</code> and <code class="literal">Credentials.getPassword()</code>,
        respectively (you can get a reference to the <code class="literal">credentials</code> component via
        <code class="literal">Identity.instance().getCredentials()</code>).  Any roles that the user is a member of 
        should be assigned using <code class="literal">Identity.addRole()</code>. Here's a complete example of an 
        authentication method inside a POJO component:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;authenticator&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Authenticator</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;entityManager</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_plain">&nbsp;</span><span class="java_type">Credentials</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_plain">&nbsp;</span><span class="java_type">Identity</span><span class="java_plain">&nbsp;identity</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;authenticate</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">User</span><span class="java_separator">)</span><span class="java_plain">&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;from&nbsp;User&nbsp;where&nbsp;username&nbsp;=&nbsp;:username&nbsp;and&nbsp;password&nbsp;=&nbsp;:password&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;username&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">.</span><span class="java_plain">getUsername</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;password&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">.</span><span class="java_plain">getPassword</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">user</span><span class="java_separator">.</span><span class="java_plain">getRoles</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">UserRole</span><span class="java_plain">&nbsp;mr&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;user</span><span class="java_separator">.</span><span class="java_plain">getRoles</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;identity</span><span class="java_separator">.</span><span class="java_plain">addRole</span><span class="java_separator">(</span><span class="java_plain">mr</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">NoResultException</span><span class="java_plain">&nbsp;ex</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
        In the above example, both <code class="literal">User</code> and <code class="literal">UserRole</code> are application-specific
        entity beans.  The <code class="literal">roles</code> parameter is populated with the roles that the user is a member
        of, which should be added to the <code class="literal">Set</code> as literal string values, e.g. "admin", "user".
        In this case, if the user record is not found and a <code class="literal">NoResultException</code> thrown, the
        authentication method returns <code class="literal">false</code> to indicate the authentication failed.
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
           When writing an authenticator method, it is important that it is kept minimal and free from
           any side-effects. This is because there is no guarantee as to how many times the authenticator
           method will be called by the security API, and as such it may be invoked multiple times during
           a single request.  Because of this, any special code that should execute upon a successful or
           failed authentication should be written by implementing an event observer.  See the section on
           Security Events further down in this chapter for more information about which events are
           raised by Seam Security.
        </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8288"/>15.3.2.1. Identity.addRole()</h4></div></div></div><p>
          The <code class="literal">Identity.addRole()</code> method behaves differently depending on whether the current
          session is authenticated or not.  If the session is not authenticated, then <code class="literal">addRole()</code>
          should <span class="emphasis"><em>only</em></span> be called during the authentication process.  When called here, the
          role name is placed into a temporary list of pre-authenticated roles.  Once authentication is successful,
          the pre-authenticated roles then become "real" roles, and calling <code class="literal">Identity.hasRole()</code>
          for those roles will then return true.  The following sequence diagram represents the list of pre-authenticated
          roles as a first class object to show more clearly how it fits in to the authentication process.

        </p><div class="mediaobject" align="center"><img src="images/security-addrole.png" align="middle"/></div><p>
          If the current session is already authenticated, then calling <code class="literal">Identity.addRole()</code> will
          have the expected effect of immediately granting the specified role to the current user.
        </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8315"/>15.3.2.2. Writing an event observer for security-related events</h4></div></div></div><p>
          Say for example, that upon a successful login that some user statistics must be
          updated.  This would be done by writing an event observer for the
          <code class="literal">org.jboss.seam.security.loginSuccessful</code> event, like this:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><!-- <br/> --><span class="java_type">In</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">UserStats</span><!-- <br/> --><span class="java_plain">&nbsp;userStats</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Observer</span><span class="java_separator">(</span><span class="java_literal">&quot;org.jboss.seam.security.loginSuccessful&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;updateUserStats</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userStats</span><span class="java_separator">.</span><span class="java_plain">setLastLoginDate</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userStats</span><span class="java_separator">.</span><span class="java_plain">incrementLoginCount</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>
          This observer method can be placed anywhere, even in the Authenticator component itself.
          You can find more information about security-related events later in this chapter.
        </p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8327"/>15.3.3. Writing a login form</h3></div></div></div><p>
        The <code class="literal">credentials</code> component provides both <code class="literal">username</code> and <code class="literal">password</code>
        properties, catering for the most common authentication scenario. These properties can be bound directly to the
        username and password fields on a login form.  Once these properties are set, calling 
        <code class="literal">identity.login()</code> will authenticate the user using the provided credentials.
        Here's an example of a simple login form:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Username&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{credentials.username}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Password&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputSecret</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{credentials.password}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Login&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{identity.login}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Similarly, logging out the user is done by calling <code class="literal">#{identity.logout}</code>. Calling this
        action will clear the security state of the currently authenticated user, and invalidate the user's session.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8351"/>15.3.4. Configuration Summary</h3></div></div></div><p>
        So to sum up, there are the three easy steps to configure authentication:
      </p><div class="itemizedlist"><ul><li><p>
            Configure an authentication method in <code class="literal">components.xml</code>.
          </p></li><li><p>
            Write an authentication method.
          </p></li><li><p>
            Write a login form so that the user can authenticate.
          </p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8369"/>15.3.5. Remember Me</h3></div></div></div><p>
        Seam Security supports the same kind of "Remember Me" functionality that is commonly encountered in many
        online web-based applications.  It is actually supported in two different "flavours", or modes - the first
        mode allows the username to be stored in the user's browser as a cookie, and leaves the entering of the
        password up to the browser (many modern browsers are capable of remembering passwords).
      </p><p>
        The second mode supports the storing of a unique token in a cookie, and allows a user to authenticate
        automatically upon returning to the site, without having to provide a password.
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>
          Automatic client authentication with a persistent cookie stored on the client machine is dangerous.  
          While convenient for users, any cross-site scripting security hole in your website would have dramatically more 
          serious effects than usual. Without the authentication cookie, the only cookie to steal for an attacker with XSS 
          is the cookie of the current session of a user. This means the attack only works when the user has an open session - 
          which should be a short timespan. However, it is much more attractive and dangerous if an attacker has the possibility 
          to steal a persistent Remember Me cookie that allows him to login without authentication, at any time. Note that this 
          all depends on how well you protect your website against XSS attacks - it's up to you to make sure that your website 
          is 100% XSS safe - a non-trivial achievement for any website that allows user input to be rendered on a page.          
        </p><p>
          Browser vendors recognized this issue and introduced a "Remember Passwords" feature - today almost all browsers support 
          this. Here, the browser remembers the login username and password for a particular website and domain, and fills out the 
          login form automatically when you don't have an active session with the website. If you as a website designer then offer 
          a convenient login keyboard shortcut, this approach is almost as convenient as a "Remember Me" cookie and much safer. 
          Some browsers (e.g. Safari on OS X) even store the login form data in the encrypted global operation system keychain. 
          Or, in a networked environment, the keychain can be transported with the user (between laptop and desktop for example), 
          while browser cookies are usually not synchronized.
        </p><p>
          To summarize: While everyone is doing it, persistent "Remember Me" cookies with automatic authentication are a bad 
          practice and should not be used. Cookies that "remember" only the users login name, and fill out the login form with 
          that username as a convenience, are not an issue. 
        </p></div><p>
        To enable the remember me feature for the default (safe, username only) mode, no special configuration is required.
        In your login form, simply bind the remember me checkbox to <code class="literal">rememberMe.enabled</code>, like in the following
        example:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;User&nbsp;name&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{credentials.username}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Password&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputSecret</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{credentials.password}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">redisplay</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;loginRow&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;rememberMe&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Remember&nbsp;me&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:selectBooleanCheckbox</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;rememberMe&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{rememberMe.enabled}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8390"/>15.3.5.1. Token-based Remember-me Authentication</h4></div></div></div><p>
          To use the automatic, token-based mode of the remember me feature, you must first configure a token store.  The
          most common scenario is to store these authentication tokens within a database (which Seam supports), however it 
          is possible to implement your own token store by implementing the <code class="literal">org.jboss.seam.security.TokenStore</code>
          interface.  This section will assume you will be using the provided <code class="literal">JpaTokenStore</code> implementation
          to store authentication tokens inside a database table.
        </p><p>
          The first step is to create a new Entity which will contain the tokens.  The following example shows a possible
          structure that you may use:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AuthenticationToken</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;tokenId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getTokenId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;tokenId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setTokenId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;tokenId</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">tokenId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;tokenId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenUsername</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getUsername</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUsername</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">username&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getValue</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setValue</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;value</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
          As you can see from this listing, a couple of special annotations, <code class="literal">@TokenUsername</code> and
          <code class="literal">@TokenValue</code> are used to configure the username and token properties of the entity.  These
          annotations are required for the entity that will contain the authentication tokens.
        </p><p>
          The next step is to configure <code class="literal">JpaTokenStore</code> to use this entity bean to store and retrieve
          authentication tokens.  This is done in <code class="literal">components.xml</code> by specifying the <code class="literal">token-class</code>
          attribute:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:jpa-token-store</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">token-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.example.seamspace.AuthenticationToken&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>
          Once this is done, the last thing to do is to configure the <code class="literal">RememberMe</code> component in
          <code class="literal">components.xml</code> also.  Its <code class="literal">mode</code> should be set to <code class="literal">autoLogin</code>:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:remember-me</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;autoLogin&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>
          That is all that is required - automatic authentication will now occur for users revisiting your site (as long as they
          check the "remember me" checkbox).
        </p><p>
          To ensure that users are automatically authenticated when returning to the site, the following section
          should be placed in components.xml:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.notLoggedIn&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">execute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{redirect.captureCurrentView}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">execute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{identity.tryLogin()}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.loginSuccessful&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">execute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{redirect.returnToCapturedView}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8448"/>15.3.6. Handling Security Exceptions</h3></div></div></div><p>
        To prevent users from receiving the default error page in response to a security error, it's recommended that
        <code class="literal">pages.xml</code> is configured to redirect security errors to a more "pretty" page.  The two
        main types of exceptions thrown by the security API are:
      </p><div class="itemizedlist"><ul><li><p>
            <code class="literal">NotLoggedInException</code> - This exception is thrown if the user attempts to access a
            restricted action or page when they are not logged in.
          </p></li><li><p>
            <code class="literal">AuthorizationException</code> - This exception is only thrown if the user is already logged in,
            and they have attempted to access a restricted action or page for which they do not have the necessary
            privileges.
          </p></li></ul></div><p>
        In the case of a <code class="literal">NotLoggedInException</code>, it is recommended that the user is redirected to
        either a login or registration page so that they can log in.  For an <code class="literal">AuthorizationException</code>,
        it may be useful to redirect the user to an error page. Here's an example of a <code class="literal">pages.xml</code>
        file that redirects both of these security exceptions:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pages</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exception</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.NotLoggedInException&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">redirect</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/login.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">You&nbsp;must&nbsp;be&nbsp;logged&nbsp;in&nbsp;to&nbsp;perform&nbsp;this&nbsp;action</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">redirect</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">exception</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exception</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.AuthorizationException&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">end-conversation</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">redirect</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/security_error.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">You&nbsp;do&nbsp;not&nbsp;have&nbsp;the&nbsp;necessary&nbsp;security&nbsp;privileges&nbsp;to&nbsp;perform&nbsp;this&nbsp;action.</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">redirect</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">exception</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pages</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Most web applications require even more sophisticated handling of login redirection, so
        Seam includes some special functionality for handling this problem.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8484"/>15.3.7. Login Redirection</h3></div></div></div><p>
        You can ask Seam to redirect the user to a login screen when an unauthenticated user tries
        to access a particular view (or wildcarded view id) as follows:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pages</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">login-view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/login.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">page</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/members/*&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">login-required</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pages</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
           This is less of a blunt instrument than the exception handler shown above, but should
           probably be used in conjunction with it.
         </p></div><p>
        After the user logs in, we want to automatically send them back where they came from, so
        they can retry the action that required logging in. If you add the following event listeners
        to <code class="literal">components.xml</code>, attempts to access a restricted view while not logged
        in will be remembered, so that upon the user successfully logging in they will be redirected
        to the originally requested view, with any page parameters that existed in the original
        request.
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.notLoggedIn&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">execute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{redirect.captureCurrentView}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.postAuthenticate&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">execute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{redirect.returnToCapturedView}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Note that login redirection is implemented as a conversation-scoped mechanism, so don't end
        the conversation in your <code class="literal">authenticate()</code> method.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8506"/>15.3.8. HTTP Authentication</h3></div></div></div><p>
        Although not recommended for use unless absolutely necessary, Seam provides means for authenticating
        using either HTTP Basic or HTTP Digest (RFC 2617) methods.  To use either form of authentication,
        the <code class="literal">authentication-filter</code> component must be enabled in components.xml:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">web:authentication-filter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">url-pattern</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;*.seam&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">auth-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;basic&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>
        To enable the filter for basic authentication, set <code class="literal">auth-type</code> to <code class="literal">basic</code>,
        or for digest authentication, set it to <code class="literal">digest</code>.  If using digest authentication, the
        <code class="literal">key</code> and <code class="literal">realm</code> must also be set:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">web:authentication-filter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">url-pattern</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;*.seam&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">auth-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;digest&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">key</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;AA3JK34aSDlkj&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">realm</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;My&nbsp;App&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>
        The <code class="literal">key</code> can be any String value.  The <code class="literal">realm</code> is the name of the
        authentication realm that is presented to the user when they authenticate.
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8543"/>15.3.8.1. Writing a Digest Authenticator</h4></div></div></div><p>
          If using digest authentication, your authenticator class should extend the abstract class
          <code class="literal">org.jboss.seam.security.digest.DigestAuthenticator</code>, and use the
          <code class="literal">validatePassword()</code> method to validate the user's plain text password
          against the digest request.  Here is an example:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;authenticate</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">User</span><span class="java_separator">)</span><span class="java_plain">&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;from&nbsp;User&nbsp;where&nbsp;username&nbsp;=&nbsp;:username&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;username&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;identity</span><span class="java_separator">.</span><span class="java_plain">getUsername</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;validatePassword</span><span class="java_separator">(</span><span class="java_plain">user</span><span class="java_separator">.</span><span class="java_plain">getPassword</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">NoResultException</span><span class="java_plain">&nbsp;ex</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8556"/>15.3.9. Advanced Authentication Features</h3></div></div></div><p>
        This section explores some of the advanced features provided by the security API for addressing more complex
        security requirements.
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8561"/>15.3.9.1. Using your container's JAAS configuration</h4></div></div></div><p>
          If you would rather not use the simplified JAAS configuration provided by the Seam Security API, you may
          instead delegate to the default system JAAS configuration by providing a <code class="literal">jaas-config-name</code>
          property in <code class="literal">components.xml</code>.  For example, if you are using JBoss AS and wish to use
          the <code class="literal">other</code> policy (which uses the <code class="literal">UsersRolesLoginModule</code> login module
          provided by JBoss AS), then the entry in <code class="literal">components.xml</code> would look like this:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:identity</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">jaas-config-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;other&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
          Please keep in mind that doing this does not mean that your user will be authenticated in whichever
          container your Seam application is deployed in.  It merely instructs Seam Security to authenticate
          itself using the configured JAAS security policy.
        </p></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8585"/>15.4. Identity Management</h2></div></div></div><p>
      Identity Management provides a standard API for the management of a Seam application's users and roles,
      regardless of which identity store (database, LDAP, etc) is used on the backend.  At the center
      of the Identity Management API is the <code class="literal">identityManager</code> component, which provides 
      all the methods for creating, modifying and deleting users, granting and revoking roles, changing passwords,
      enabling and disabling user accounts, authenticating users and listing users and roles.
    </p><p>
      Before it may be used, the <code class="literal">identityManager</code> must first be configured with one or more
      <code class="literal">IdentityStore</code>s.  These components do the actual work of interacting with the backend
      security provider, whether it be a database, LDAP server, or something else.
    </p><div class="mediaobject" align="center"><img src="images/security-identitymanager.png" align="middle"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8606"/>15.4.1. Configuring IdentityManager</h3></div></div></div><p>    
        The <code class="literal">identityManager</code> component allows for separate identity stores to be configured 
        for authentication and authorization operations.  This means that it is possible for users to
        be authenticated against one identity store, for example an LDAP directory, yet have their roles 
        loaded from another identity store, such as a relational database.
      </p><p>
        Seam provides two <code class="literal">IdentityStore</code> implementations out of the box; 
        <code class="literal">JpaIdentityStore</code> uses a relational database to store user and role information, 
        and is the default identity store that is used if nothing is explicitly configured in the
        <code class="literal">identityManager</code> component.  The other implementation that is provided is 
        <code class="literal">LdapIdentityStore</code>, which uses an LDAP directory to store users and roles.
      </p><p>
        There are two configurable properties for the <code class="literal">identityManager</code> component - 
        <code class="literal">identityStore</code> and <code class="literal">roleIdentityStore</code>.  The value for these
        properties must be an EL expression referring to a Seam component implementing the
        <code class="literal">IdentityStore</code> interface.  As already mentioned,
        if left unconfigured then <code class="literal">JpaIdentityStore</code> will be assumed by default.  If
        only the <code class="literal">identityStore</code> property is configured, then the same value will be used for
        <code class="literal">roleIdentityStore</code> also.  For example, the following entry in
        <code class="literal">components.xml</code> will configure <code class="literal">identityManager</code> to use
        an <code class="literal">LdapIdentityStore</code> for both user-related and role-related operations:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:identity-manager</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identity-store</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{ldapIdentityStore}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>
        The following example configures <code class="literal">identityManager</code> to use an <code class="literal">LdapIdentityStore</code>
        for user-related operations, and <code class="literal">JpaIdentityStore</code> for role-related operations:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:identity-manager</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">identity-store</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{ldapIdentityStore}&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">role-identity-store</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{jpaIdentityStore}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>
        The following sections explain both of these identity store implementations in greater detail.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8677"/>15.4.2. JpaIdentityStore</h3></div></div></div><p>
        This identity store allows for users and roles to be stored inside a relational database.  It is designed 
        to be as unrestrictive as possible in regards to database schema design, allowing a great deal of 
        flexibility in the underlying table structure.  This is achieved through the use of a set of special
        annotations, allowing entity beans to be configured to store user and role records.  
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8682"/>15.4.2.1. Configuring JpaIdentityStore</h4></div></div></div><p>
          <code class="literal">JpaIdentityStore</code> requires that both the <code class="literal">user-class</code> and 
          <code class="literal">role-class</code> properties are configured.  These properties should refer to the
          entity classes that are to be used to store both user and role records, respectively.  The following
          example shows the configuration from <code class="literal">components.xml</code> in the SeamSpace example:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:jpa-identity-store</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">user-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.example.seamspace.MemberAccount&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">role-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.example.seamspace.MemberRole&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8701"/>15.4.2.2. Configuring the Entities</h4></div></div></div><p>
          As already mentioned, a set of special annotations are used to configure entity beans for storing
          users and roles.  The following table lists each of the annotations, and their descriptions.
        </p><div class="table"><a id="d0e8706"/><p class="title"><b>Table 15.1. User Entity Annotations</b></p><div class="table-contents"><table summary="User Entity Annotations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                  <p>Annotation</p>
                </th><th align="center">
                  <p>Status</p>
                </th><th align="center">
                  <p>Description</p>
                </th></tr></thead><tbody><tr><td>
                  <p>
                    <code class="literal">@UserPrincipal</code>
                  </p>
                </td><td>
                  <p>Required</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the user's username.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">@UserPassword</code>
                  </p>
                </td><td>
                  <p>Required</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the user's password.  It allows a <code class="literal">hash</code>
                    algorithm to be specified for password hashing.  Possible values for <code class="literal">hash</code> are
                    <code class="literal">md5</code>, <code class="literal">sha</code> and <code class="literal">none</code>.  E.g:
                  </p>

                  <pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">UserPassword</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">hash</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;md5&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getPasswordHash</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

                  <p>
                    If an application requires a hash algorithm that isn't supported natively by Seam, it
                    is possible to extend the <code class="literal">PasswordHash</code> component to implement other
                    hashing algorithms.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">@UserFirstName</code>
                  </p>
                </td><td>
                  <p>Optional</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the user's first name.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">@UserLastName</code>
                  </p>
                </td><td>
                  <p>Optional</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the user's last name.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">@UserEnabled</code>
                  </p>
                </td><td>
                  <p>Optional</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the enabled status of the user.  This should be a boolean
                    property, and if not present then all user accounts are assumed to be enabled.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">@UserRoles</code>
                  </p>
                </td><td>
                  <p>Required</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the roles of the user.  This property will be described in 
                    more detail further down.
                  </p>
                </td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e8869"/><p class="title"><b>Table 15.2. Role Entity Annotations</b></p><div class="table-contents"><table summary="Role Entity Annotations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                  <p>Annotation</p>
                </th><th align="center">
                  <p>Status</p>
                </th><th align="center">
                  <p>Description</p>
                </th></tr></thead><tbody><tr><td>
                  <p>
                    <code class="literal">@RoleName</code>
                  </p>
                </td><td>
                  <p>Required</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the name of the role.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">@RoleGroups</code>
                  </p>
                </td><td>
                  <p>Optional</p>
                </td><td>
                  <p>
                    This annotation marks the field or method containing the group memberships of the role.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">@RoleConditional</code>
                  </p>
                </td><td>
                  <p>Optional</p>
                </td><td>
                  <p>
                    This annotation marks the field or method indicating whether the role is conditional or not.
                    Conditional roles are explained later in this chapter.
                  </p>
                </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8951"/>15.4.2.3. Entity Bean Examples</h4></div></div></div><p>
          As mentioned previously, <code class="literal">JpaIdentityStore</code> is designed to be as flexible as possible when
          it comes to the database schema design of your user and role tables.  This section looks at a number of
          possible database schemas that can be used to store user and role records.
        </p><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8959"/>15.4.2.3.1. Minimal schema example</h5></div></div></div><p>
            In this bare minimal example, a simple user and role table are linked via a
            many-to-many relationship using a cross-reference table named <code class="literal">UserRoles</code>.
          </p><div class="mediaobject" align="center"><img src="images/security-entities-1.png" align="middle"/></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getUserId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUserId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">userId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserPrincipal</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getUsername</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUsername</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">username&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserPassword</span><span class="java_separator">(</span><span class="java_plain">hash&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;md5&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getPasswordHash</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setPasswordHash</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">passwordHash&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserRoles</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">targetEntity&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Role</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;UserRoles&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;joinColumns&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;UserId&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;inverseJoinColumns&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;RoleId&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getRoles</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRoles</span><span class="java_separator">(</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">roles&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Role</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">Generated</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getRoleId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRoleId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">roleId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">RoleName</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getRolename</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRolename</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">rolename&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8976"/>15.4.2.3.2. Complex Schema Example</h5></div></div></div><p>
            This example builds on the above minimal example by including all of the optional fields, and allowing
            group memberships for roles.
          </p><div class="mediaobject" align="center"><img src="images/security-entities-2.png" align="middle"/></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;firstname</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lastname</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;enabled</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getUserId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUserId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">userId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserPrincipal</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getUsername</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUsername</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">username&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserPassword</span><span class="java_separator">(</span><span class="java_plain">hash&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;md5&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getPasswordHash</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setPasswordHash</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">passwordHash&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;passwordHash</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserFirstName</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getFirstname</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;firstname</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setFirstname</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;firstname</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">firstname&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstname</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserLastName</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getLastname</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;lastname</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setLastname</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;lastname</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">lastname&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;lastname</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserEnabled</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isEnabled</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;enabled</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setEnabled</span><span class="java_separator">(</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;enabled</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">enabled&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;enabled</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">UserRoles</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">targetEntity&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Role</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;UserRoles&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;joinColumns&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;UserId&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;inverseJoinColumns&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;RoleId&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getRoles</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRoles</span><span class="java_separator">(</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">roles&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;roles</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Role</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;conditional</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">Generated</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getRoleId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRoleId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">roleId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;roleId</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">RoleName</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getRolename</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRolename</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">rolename&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rolename</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">RoleConditional</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isConditional</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;conditional</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setConditional</span><span class="java_separator">(</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;conditional</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">conditional&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;conditional</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">RoleGroups</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">targetEntity&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Role</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;RoleGroups&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;joinColumns&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;RoleId&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;inverseJoinColumns&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;GroupId&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getGroups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setGroups</span><span class="java_separator">(</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">groups&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8990"/>15.4.2.4. JpaIdentityStore Events</h4></div></div></div><p>
          When using <code class="literal">JpaIdentityStore</code> as the identity store implementation with <code class="literal">IdentityManager</code>,
          a few events are raised as a result of invoking certain <code class="literal">IdentityManager</code> methods.
        </p><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9004"/>15.4.2.4.1. JpaIdentityStore.EVENT_PRE_PERSIST_USER</h5></div></div></div><p>
            This event is raised in response to calling <code class="literal">IdentityManager.createUser()</code>.  Just before the user
            entity is persisted to the database, this event will be raised passing the entity instance as an event parameter.  
            The entity will be an instance of the <code class="literal">user-class</code> configured for <code class="literal">JpaIdentityStore</code>.            
          </p><p>
            Writing an observer for this event may be useful for setting additional field values on the entity, which aren't set
            as part of the standard <code class="literal">createUser()</code> functionality.
          </p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9023"/>15.4.2.4.2. JpaIdentityStore.EVENT_USER_CREATED</h5></div></div></div><p>
            This event is also raised in response to calling <code class="literal">IdentityManager.createUser()</code>.  However, it is 
            raised after the user entity has already been persisted to the database.  Like the <code class="literal">EVENT_PRE_PERSIST_USER</code>
            event, it also passes the entity instance as an event parameter.  It may be useful to observe this event if you also
            need to persist other entities that reference the user entity, for example contact detail records or other user-specific
            data.
          </p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9034"/>15.4.2.4.3. JpaIdentityStore.EVENT_USER_AUTHENTICATED</h5></div></div></div><p>
            This event is raised when calling <code class="literal">IdentityManager.authenticate()</code>.  It passes the user entity instance
            as the event parameter, and is useful for reading additional properties from the user entity that is being authenticated.
          </p></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e9042"/>15.4.3. LdapIdentityStore</h3></div></div></div><p>
        This identity store implementation is designed for working with user records stored in an LDAP directory.  It is very
        highly configurable, allowing great flexibility in how both users and roles are stored in the directory.  The following
        sections describe the configuration options for this identity store, and provide some configuration examples.
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e9047"/>15.4.3.1. Configuring LdapIdentityStore</h4></div></div></div><p>
          The following table describes the available properties that can be configured in <code class="literal">components.xml</code> for
          <code class="literal">LdapIdentityStore</code>.
        </p><div class="table"><a id="d0e9058"/><p class="title"><b>Table 15.3. LdapIdentityStore Configuration Properties</b></p><div class="table-contents"><table summary="LdapIdentityStore Configuration Properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                  <p>Property</p>
                </th><th align="center">
                  <p>Default Value</p>
                </th><th align="center">
                  <p>Description</p>
                </th></tr></thead><tbody><tr><td>
                  <p>
                    <code class="literal">server-address</code>
                  </p>
                </td><td>
                  <p><code class="literal">localhost</code></p>
                </td><td>
                  <p>
                    The address of the LDAP server.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">server-port</code>
                  </p>
                </td><td>
                  <p><code class="literal">389</code></p>
                </td><td>
                  <p>
                    The port number that the LDAP server is listening on.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">user-context-DN</code>
                  </p>
                </td><td>
                  <p><code class="literal">ou=Person,dc=acme,dc=com</code></p>
                </td><td>
                  <p>
                    The Distinguished Name (DN) of the context containing user records.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">user-DN-prefix</code>
                  </p>
                </td><td>
                  <p><code class="literal">uid=</code></p>
                </td><td>
                  <p>
                    This value is prefixed to the front of the username to locate the user's record.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">user-DN-suffix</code>
                  </p>
                </td><td>
                  <p><code class="literal">,ou=Person,dc=acme,dc=com</code></p>
                </td><td>
                  <p>
                    This value is appended to the end of the username to locate the user's record.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">role-context-DN</code>
                  </p>
                </td><td>
                  <p><code class="literal">ou=Role,dc=acme,dc=com</code></p>
                </td><td>
                  <p>
                    The DN of the context containing role records.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">role-DN-prefix</code>
                  </p>
                </td><td>
                  <p><code class="literal">cn=</code></p>
                </td><td>
                  <p>
                    This value is prefixed to the front of the role name to form the DN for locating the 
                    role record.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">role-DN-suffix</code>
                  </p>
                </td><td>
                  <p><code class="literal">,ou=Roles,dc=acme,dc=com</code></p>
                </td><td>
                  <p>
                    This value is appended to the role name to form the DN for locating the role record.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">bind-DN</code>
                  </p>
                </td><td>
                  <p><code class="literal">cn=Manager,dc=acme,dc=com</code></p>
                </td><td>
                  <p>
                    This is the context used to bind to the LDAP server.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">bind-credentials</code>
                  </p>
                </td><td>
                  <p><code class="literal">secret</code></p>
                </td><td>
                  <p>
                    These are the credentials (the password) used to bind to the LDAP server.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">user-role-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">roles</code></p>
                </td><td>
                  <p>
                    This is the name of the attribute of the user record that contains the list of roles that the
                    user is a member of.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">role-attribute-is-DN</code>
                  </p>
                </td><td>
                  <p><code class="literal">true</code></p>
                </td><td>
                  <p>
                    This boolean property indicates whether the role attribute of the user record is itself a
                    distinguished name.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">user-name-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">uid</code></p>
                </td><td>
                  <p>
                    Indicates which attribute of the user record contains the username.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">user-password-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">userPassword</code></p>
                </td><td>
                  <p>
                    Indicates which attribute of the user record contains the user's password.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">first-name-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">null</code></p>
                </td><td>
                  <p>
                    Indicates which attribute of the user record contains the user's first name.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">last-name-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">sn</code></p>
                </td><td>
                  <p>
                    Indicates which attribute of the user record contains the user's last name.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">full-name-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">cn</code></p>
                </td><td>
                  <p>
                    Indicates which attribute of the user record contains the user's full (common) name.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">enabled-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">null</code></p>
                </td><td>
                  <p>
                    Indicates which attribute of the user record determines whether the user is enabled.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">role-name-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">cn</code></p>
                </td><td>
                  <p>
                    Indicates which attribute of the role record contains the name of the role.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">object-class-attribute</code>
                  </p>
                </td><td>
                  <p><code class="literal">objectClass</code></p>
                </td><td>
                  <p>
                    Indicates which attribute determines the class of an object in the directory.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">role-object-classes</code>
                  </p>
                </td><td>
                  <p><code class="literal">organizationalRole</code></p>
                </td><td>
                  <p>
                    An array of the object classes that new role records should be created as.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">user-object-classes</code>
                  </p>
                </td><td>
                  <p><code class="literal">person,uidObject</code></p>
                </td><td>
                  <p>
                    An array of the object classes that new user records should be created as.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">security-authentication-type</code>
                  </p>
                </td><td>
                  <p><code class="literal">simple</code></p>
                </td><td>
                  <p>
                    The security level to use.  Possible values are "none", "simple" and "strong".
                  </p>
                </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e9543"/>15.4.3.2. LdapIdentityStore Configuration Example</h4></div></div></div><p>
          The following configuration example shows how <code class="literal">LdapIdentityStore</code> may be configured for
          an LDAP directory running on fictional host <code class="literal">directory.mycompany.com</code>.  The users are stored
          within this directory under the context <code class="literal">ou=Person,dc=mycompany,dc=com</code>, and are identified
          using the <code class="literal">uid</code> attribute (which corresponds to their username).  Roles are stored in their
          own context, <code class="literal">ou=Roles,dc=mycompany,dc=com</code> and referenced from the user's entry via the 
          <code class="literal">roles</code> attribute.  Role entries are identified by their common name (the <code class="literal">cn</code> attribute)
          , which corresponds to the role name.  In this example, users may be disabled by setting the value of their 
          <code class="literal">enabled</code> attribute to false.
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:ldap-identity-store</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">server-address</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;directory.mycompany.com&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">bind-DN</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cn=Manager,dc=mycompany,dc=com&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">bind-credentials</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;secret&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">user-DN-prefix</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;uid=&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">user-DN-suffix</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;,ou=Person,dc=mycompany,dc=com&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">role-DN-prefix</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cn=&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">role-DN-suffix</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;,ou=Roles,dc=mycompany,dc=com&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">user-context-DN</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ou=Person,dc=mycompany,dc=com&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">role-context-DN</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ou=Roles,dc=mycompany,dc=com&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">user-role-attribute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;roles&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">role-name-attribute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cn&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">user-object-classes</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;person,uidObject&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">enabled-attribute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;enabled&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e9574"/>15.4.4. Writing your own IdentityStore</h3></div></div></div><p>
        Writing your own identity store implementation allows you to authenticate and perform identity management
        operations against security providers that aren't supported out of the box by Seam.  Only a single class is 
        required to achieve this, and it must implement the
        <code class="literal">org.jboss.seam.security.management.IdentityStore</code> interface.
      </p><p>
        Please refer to the JavaDoc for <code class="literal">IdentityStore</code> for a description of the methods that
        must be implemented.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e9587"/>15.4.5. Authentication with Identity Management</h3></div></div></div><p>
        If you are using the Identity Management features in your Seam application, then it is not required
        to provide an authenticator component (see previous Authentication section) to enable authentication.
        Simply omit the <code class="literal">authenticate-method</code> from the <code class="literal">identity</code> configuration
        in <code class="literal">components.xml</code>, and the <code class="literal">SeamLoginModule</code> will by default
        use <code class="literal">IdentityManager</code> to authenticate your application's users, without any special
        configuration required.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e9607"/>15.4.6. Using IdentityManager</h3></div></div></div><p>
        The <code class="literal">IdentityManager</code> can be accessed either by injecting it into your Seam
        component as follows:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;@</span><!-- <br/> --><span class="java_type">In</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">IdentityManager</span><!-- <br/> --><span class="java_plain">&nbsp;identityManager</span><!-- <br/> --><span class="java_separator">;</span></pre><p>
        or by accessing it through its static <code class="literal">instance()</code> method:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;</span><!-- <br/> --><span class="java_type">IdentityManager</span><!-- <br/> --><span class="java_plain">&nbsp;identityManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">IdentityManager</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">instance</span><!-- <br/> --><span class="java_separator">();</span></pre><p>
        The following table describes <code class="literal">IdentityManager</code>'s API methods:
      </p><div class="table"><a id="d0e9629"/><p class="title"><b>Table 15.4. Identity Management API</b></p><div class="table-contents"><table summary="Identity Management API" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                <p>Method</p>
              </th><th align="center">
                <p>Returns</p>
              </th><th align="center">
                <p>Description</p>
              </th></tr></thead><tbody><tr><td>
                <p>
                  <code class="literal">createUser(String name, String password)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Creates a new user account, with the specified name and password.  Returns <code class="literal">true</code>
                  if successful, or <code class="literal">false</code> if not.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">deleteUser(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Deletes the user account with the specified name.  Returns <code class="literal">true</code>
                  if successful, or <code class="literal">false</code> if not.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">createRole(String role)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Creates a new role, with the specified name.  Returns <code class="literal">true</code>
                  if successful, or <code class="literal">false</code> if not.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">deleteRole(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Deletes the role with the specified name.  Returns <code class="literal">true</code>
                  if successful, or <code class="literal">false</code> if not.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">enableUser(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Enables the user account with the specified name.  Accounts that are not enabled are
                  not able to authenticate.  Returns <code class="literal">true</code> if successful, or
                  <code class="literal">false</code> if not.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">disableUser(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Disables the user account with the specified name.  Returns <code class="literal">true</code> if
                  successful, or <code class="literal">false</code> if not.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">changePassword(String name, String password)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Changes the password for the user account with the specified name.  Returns
                  <code class="literal">true</code> if successful, or <code class="literal">false</code> if not.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">isUserEnabled(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Returns <code class="literal">true</code> if the specified user account is enabled, or
                  <code class="literal">false</code> if it isn't.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">grantRole(String name, String role)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Grants the specified role to the specified user or role.  The role must already exist for it to
                  be granted.  Returns <code class="literal">true</code> if the role is successfully granted, or
                  <code class="literal">false</code> if it is already granted to the user.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">revokeRole(String name, String role)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Revokes the specified role from the specified user or role.  Returns <code class="literal">true</code>
                  if the specified user is a member of the role and it is successfully revoked, or
                  <code class="literal">false</code> if the user is not a member of the role.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">userExists(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Returns <code class="literal">true</code> if the specified user exists, or <code class="literal">false</code>
                  if it doesn't.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">listUsers()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">List</code>
                </p>
              </td><td>
                <p>
                  Returns a list of all user names, sorted in alpha-numeric order.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">listUsers(String filter)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">List</code>
                </p>
              </td><td>
                <p>
                  Returns a list of all user names filtered by the specified filter parameter, sorted in alpha-numeric order.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">listRoles()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">List</code>
                </p>
              </td><td>
                <p>
                  Returns a list of all role names.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">getGrantedRoles(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">List</code>
                </p>
              </td><td>
                <p>
                  Returns a list of the names of all the roles explicitly granted to the specified user name.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">getImpliedRoles(String name)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">List</code>
                </p>
              </td><td>
                <p>
                  Returns a list of the names of all the roles implicitly granted to the specified user name.
                  Implicitly granted roles include those that are not directly granted to a user, rather they are
                  granted to the roles that the user is a member of.  For example, is the <code class="literal">admin</code>
                  role is a member of the <code class="literal">user</code> role, and a user is a member of the <code class="literal">admin</code>
                  role, then the implied roles for the user are both the <code class="literal">admin</code>, and <code class="literal">user</code>
                  roles.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">authenticate(String name, String password)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Authenticates the specified username and password using the configured Identity Store.  Returns
                  <code class="literal">true</code> if successful or <code class="literal">false</code> if authentication failed.
                  Successful authentication implies nothing beyond the return value of the method.  It does not
                  change the state of the <code class="literal">Identity</code> component - to perform a proper Seam login the
                  <code class="literal">Identity.login()</code> must be used instead.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">addRoleToGroup(String role, String group)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Adds the specified role as a member of the specified group.  Returns true if the operation is successful.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">removeRoleFromGroup(String role, String group)</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  Removes the specified role from the specified group.  Returns true if the operation is successful.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">listRoles()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">List</code>
                </p>
              </td><td>
                <p>
                  Lists the names of all roles.
                </p>
              </td></tr></tbody></table></div></div><br class="table-break"/><p>
        Using the Identity Management API requires that the calling user has the appropriate authorization to invoke
        its methods.  The following table describes the permission requirements for each of the methods in
        <code class="literal">IdentityManager</code>.  The permission targets listed below are literal String values.
      </p><div class="table"><a id="d0e10192"/><p class="title"><b>Table 15.5. Identity Management Security Permissions</b></p><div class="table-contents"><table summary="Identity Management Security Permissions" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                <p>Method</p>
              </th><th align="center">
                <p>Permission Target</p>
              </th><th align="center">
                <p>Permission Action</p>
              </th></tr></thead><tbody><tr><td>
                <p>
                  <code class="literal">createUser()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">create</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">deleteUser()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">delete</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">createRole()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.role</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">create</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">deleteRole()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.role</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">delete</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">enableUser()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">update</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">disableUser()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">update</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">changePassword()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">update</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">isUserEnabled()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">read</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">grantRole()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">update</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">revokeRole()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">update</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">userExists()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">read</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">listUsers()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.user</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">read</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">listRoles()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.role</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">read</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">addRoleToGroup()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.role</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">update</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">removeRoleFromGroup()</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.role</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">update</code>
                </p>
              </td></tr></tbody></table></div></div><br class="table-break"/><p>
        The following code listing provides an example set of security rules that grants access to all
        Identity Management-related methods to members of the <code class="literal">admin</code> role:
      </p><pre class="programlisting">rule ManageUsers
  no-loop
  activation-group "permissions"
when
  check: PermissionCheck(name == "seam.user", granted == false)
  Role(name == "admin")
then
  check.grant();
end

rule ManageRoles
  no-loop
  activation-group "permissions"
when
  check: PermissionCheck(name == "seam.role", granted == false)
  Role(name == "admin")
then
  check.grant();
end
</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e10599"/>15.5. Error Messages</h2></div></div></div><p>
      The security API produces a number of default faces messages for various security-related events.
      The following table lists the message keys that can be used to override these messages by specifying
      them in a <code class="literal">message.properties</code> resource file.  To suppress the message, just put the
      key with an empty value in the resource file.
    </p><div class="table"><a id="d0e10607"/><p class="title"><b>Table 15.6. Security Message Keys</b></p><div class="table-contents"><table summary="Security Message Keys" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">
              <p>Message Key</p>
            </th><th align="center">
              <p>Description</p>
            </th></tr></thead><tbody><tr><td>
              <p>
                <code class="literal">org.jboss.seam.loginSuccessful</code>
              </p>
            </td><td>
              <p>
                This message is produced when a user successfully logs in via the security API.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.loginFailed</code>
              </p>
            </td><td>
              <p>
                This message is produced when the login process fails, either because the user provided an
                incorrect username or password, or because authentication failed in some other way.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.NotLoggedIn</code>
              </p>
            </td><td>
              <p>
                This message is produced when a user attempts to perform an action or access a page that requires
                a security check, and the user is not currently authenticated.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.AlreadyLoggedIn</code>
              </p>
            </td><td>
              <p>
                This message is produced when a user that is already authenticated attempts to log in again.
              </p>
            </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e10682"/>15.6. Authorization</h2></div></div></div><p>
      There are a number of authorization mechanisms provided by the Seam Security API for securing access to
      components, component methods, and pages.  This section describes each of these.  An important thing to
      note is that if you wish to use any of the advanced features (such as rule-based permissions) then
      your <code class="literal">components.xml</code> may need to be configured to support this - see the Configuration section
      above.
    </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e10690"/>15.6.1. Core concepts</h3></div></div></div><p>
        Seam Security is built around the premise of users being granted roles and/or permissions, allowing them to
        perform operations that may not otherwise be permissible for users without the necessary security privileges.
        Each of the authorization mechanisms provided by the Seam Security API are built upon this core concept of roles and
        permissions, with an extensible framework providing multiple ways to secure application resources.
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10695"/>15.6.1.1. What is a role?</h4></div></div></div><p>
          A role is a <span class="emphasis"><em>group</em></span>, or <span class="emphasis"><em>type</em></span>, of user that may have been granted certain 
          privileges for performing one or more specific actions within an application.  They are simple constructs, consisting 
          of just a name such as "admin", "user", "customer", etc.  They can be granted either to users (or in some cases to other 
          roles), and are used to create logical groups of users for the convenient assignment of specific application privileges.
        </p><div class="mediaobject" align="center"><img src="images/security-roleclass.png" align="middle"/></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10711"/>15.6.1.2. What is a permission?</h4></div></div></div><p>
          A permission is a privilege (sometimes once-off) for performing a single, specific action.  It is entirely possible to 
          build an application using nothing but permissions, however roles offer a higher level of convenience when granting 
          privileges to groups of users.  They are slightly more complex in structure than roles, essentially consisting of three 
          "aspects"; a target, an action, and a recipient.  The target of a permission is the object (or an arbitrary name or class) 
          for which a particular action is allowed to be performed by a specific recipient (or user).  For example, the user "Bob" 
          may have permission to delete customer objects.  In this case, the permission target may be "customer", the permission 
          action would be "delete" and the recipient would be "Bob".
        </p><div class="mediaobject" align="center"><img src="images/security-permissionclass.png" align="middle"/></div><p>
          Within this documentation, permissions are generally represented in the form <code class="literal">target:action</code> 
          (omitting the recipient, although in reality one is always required).
        </p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e10726"/>15.6.2. Securing components</h3></div></div></div><p>
        Let's start by examining the simplest form of authorization, component security, starting with the
        <code class="literal">@Restrict</code> annotation.
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>@Restrict vs Typesafe security annotations</h2><p>
          While using the <code class="literal">@Restrict</code> annotation provides a powerful and flexible method for security component methods
          due to its ability to support EL expressions, it is recommended that the typesafe equivalent (described later) be
          used, at least for the compile-time safety it provides.
        </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10742"/>15.6.2.1. The @Restrict annotation</h4></div></div></div><p>
          Seam components may be secured either at the method or the class level, using the <code class="literal">@Restrict</code>
          annotation.  If both a method and it's declaring class are annotated with <code class="literal">@Restrict</code>,
          the method restriction will take precedence (and the class restriction will not apply).  If a method
          invocation fails a security check, then an exception will be thrown as per the contract for
          <code class="literal">Identity.checkRestriction()</code> (see Inline Restrictions).  A <code class="literal">@Restrict</code>
          on just the component class itself is equivalent to adding <code class="literal">@Restrict</code> to each of its
          methods.
        </p><p>
          An empty <code class="literal">@Restrict</code> implies a permission check of <code class="literal">componentName:methodName</code>.
          Take for example the following component method:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;account&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Restrict</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;delete</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
          In this example, the implied permission required to call the <code class="literal">delete()</code> method is
          <code class="literal">account:delete</code>.  The equivalent of this would be to write
          <code class="literal">@Restrict("#{s:hasPermission('account','delete')}")</code>.  Now let's look at
          another example:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Restrict</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;account&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;insert</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Restrict</span><span class="java_separator">(</span><span class="java_literal">&quot;#{s:hasRole('admin')}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;delete</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
          This time, the component class itself is annotated with <code class="literal">@Restrict</code>.  This means that
          any methods without an overriding <code class="literal">@Restrict</code> annotation require an implicit permission check.
          In the case of this example, the <code class="literal">insert()</code> method requires a permission of
          <code class="literal">account:insert</code>, while the <code class="literal">delete()</code> method requires that the user is a
          member of the <code class="literal">admin</code> role.
        </p><p>
          Before we go any further, let's address the <code class="literal">#{s:hasRole()}</code> expression seen in the above
          example.  Both <code class="literal">s:hasRole</code> and <code class="literal">s:hasPermission</code> are EL functions, which
          delegate to the correspondingly named methods of the <code class="literal">Identity</code> class. These
          functions can be used within any EL expression throughout the entirety of the security API.
        </p><p>
          Being an EL expression, the value of the <code class="literal">@Restrict</code> annotation may reference any objects that
          exist within a Seam context.  This is extremely useful when performing permission checks for a specific
          object instance.  Look at this example:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;account&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;selectedAccount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Restrict</span><span class="java_separator">(</span><span class="java_literal">&quot;#{s:hasPermission(selectedAccount,'modify')}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;modify</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectedAccount</span><span class="java_separator">.</span><span class="java_plain">modify</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
          The interesting thing to note from this example is the reference to <code class="literal">selectedAccount</code>
          seen within the <code class="literal">hasPermission()</code> function call.  The value of this variable will be
          looked up from within the Seam context, and passed to the <code class="literal">hasPermission()</code> method
          in <code class="literal">Identity</code>, which in this case can then determine if the user has the required
          permission for modifying the specified <code class="literal">Account</code> object.
        </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10843"/>15.6.2.2. Inline restrictions</h4></div></div></div><p>
          Sometimes it might be desirable to perform a security check in code, without using the
          <code class="literal">@Restrict</code> annotation.  In this situation, simply use
          <code class="literal">Identity.checkRestriction()</code> to evaluate a security expression, like this:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;deleteCustomer</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Identity</span><span class="java_separator">.</span><span class="java_plain">instance</span><span class="java_separator">().</span><span class="java_plain">checkRestriction</span><span class="java_separator">(</span><span class="java_literal">&quot;#{s:hasPermission(selectedCustomer,'delete')}&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
          If the expression specified doesn't evaluate to <code class="literal">true</code>, either
        </p><div class="itemizedlist"><ul><li><p>
                    if the user is not logged in, a <code class="literal">NotLoggedInException</code>
                    exception is thrown or
                </p></li><li><p>
                    if the user is logged in, an <code class="literal">AuthorizationException</code>
                    exception is thrown.
                </p></li></ul></div><p>
          It is also possible to call the <code class="literal">hasRole()</code> and <code class="literal">hasPermission()</code>
          methods directly from Java code:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">if</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_operator">!</span><!-- <br/> --><span class="java_type">Identity</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">instance</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">hasRole</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;admin&quot;</span><!-- <br/> --><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AuthorizationException</span><span class="java_separator">(</span><span class="java_literal">&quot;Must&nbsp;be&nbsp;admin&nbsp;to&nbsp;perform&nbsp;this&nbsp;action&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_type">Identity</span><span class="java_separator">.</span><span class="java_plain">instance</span><span class="java_separator">().</span><span class="java_plain">hasPermission</span><span class="java_separator">(</span><span class="java_literal">&quot;customer&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;create&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AuthorizationException</span><span class="java_separator">(</span><span class="java_literal">&quot;You&nbsp;may&nbsp;not&nbsp;create&nbsp;new&nbsp;customers&quot;</span><span class="java_separator">);</span></pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e10884"/>15.6.3. Security in the user interface</h3></div></div></div><p>
        One indication of a well designed user interface is that the user is not presented with options for
        which they don't have the necessary privileges to use.  Seam Security allows conditional rendering of
        either 1) sections of a page or 2) individual controls, based upon the privileges of the user, using
        the very same EL expressions that are used for component security.
      </p><p>
        Let's take a look at some examples of interface security.  First of all, let's pretend that we have a
        login form that should only be rendered if the user is not already logged in.  Using the
        <code class="literal">identity.isLoggedIn()</code> property, we can write this:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:form</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;loginForm&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{not&nbsp;identity.loggedIn}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        If the user isn't logged in, then the login form will be rendered - very straight forward so far.
        Now let's pretend there is a menu on the page that contains some actions which should only be accessible
        to users in the <code class="literal">manager</code> role.  Here's one way that these could be written:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLink</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{reports.listManagerReports}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{s:hasRole('manager')}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;Manager&nbsp;Reports</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:outputLink</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        This is also quite straight forward.  If the user is not a member of the <code class="literal">manager</code>
        role, then the outputLink will not be rendered. The <code class="literal">rendered</code> attribute can
        generally be used on the control itself, or on a surrounding <code class="literal">&lt;s:div&gt;</code> or
        <code class="literal">&lt;s:span&gt;</code> control.
      </p><p>
        Now for something more complex.  Let's say you have a <code class="literal">h:dataTable</code> control on a
        page listing records for which you may or may not wish to render action links depending on the
        user's privileges.  The <code class="literal">s:hasPermission</code> EL function allows us to pass in an
        object parameter which can be used to determine whether the user has the requested permission
        for that object or not. Here's how a dataTable with secured links might look:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:dataTable</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{clients}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">var</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cl&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:column</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">f:facet</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;header&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Name</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">f:facet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#{cl.name}</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:column</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:column</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">f:facet</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;header&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">City</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">f:facet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#{cl.city}</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:column</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:column</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">f:facet</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;header&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Action</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">f:facet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">s:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Modify&nbsp;Client&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{clientAction.modify}&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{s:hasPermission(cl,'modify')}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">s:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Delete&nbsp;Client&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{clientAction.delete}&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{s:hasPermission(cl,'delete')}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:column</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:dataTable</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e10927"/>15.6.4. Securing pages</h3></div></div></div><p>
        Page security requires that the application is using a <code class="literal">pages.xml</code> file, however is
        extremely simple to configure.  Simply include a <code class="literal">&lt;restrict/&gt;</code> element within
        the <code class="literal">page</code> elements that you wish to secure.  If no explicit restriction is specified
        by the <code class="literal">restrict</code> element, an implied permission of <code class="literal">/viewId.xhtml:render</code>
        will be checked when the page is accessed via a non-faces (GET) request, and a permission of
        <code class="literal">/viewId.xhtml:restore</code> will be required when any JSF postback (form submission) originates
        from the page.  Otherwise, the specified restriction will be evaluated as a standard security expression.
        Here's a couple of examples:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">page</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/settings.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">restrict</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">page</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        This page has an implied permission of <code class="literal">/settings.xhtml:render</code> required for non-faces
        requests and an implied permission of <code class="literal">/settings.xhtml:restore</code> for faces requests.
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">page</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/reports.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">restrict</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{s:hasRole('admin')}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">restrict</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">page</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        Both faces and non-faces requests to this page require that the user is a member of the
        <code class="literal">admin</code> role.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e10967"/>15.6.5. Securing Entities</h3></div></div></div><p>
        Seam security also makes it possible to apply security restrictions to read, insert, update and
        delete actions for entities.
      </p><p>
        To secure all actions for an entity class, add a <code class="literal">@Restrict</code> annotation on the class
        itself:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Name</span><span class="java_separator">(</span><span class="java_literal">&quot;customer&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Restrict</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
        If no expression is specified in the <code class="literal">@Restrict</code> annotation, the default security check
        that is performed is a permission check of <code class="literal">entity:action</code>, where the permission target 
        is the entity instance, and the <code class="literal">action</code> is either <code class="literal">read</code>, <code class="literal">insert</code>, 
        <code class="literal">update</code> or <code class="literal">delete</code>.
      </p><p>
        It is also possible to only restrict certain actions, by placing a <code class="literal">@Restrict</code> annotation
        on the relevant entity lifecycle method (annotated as follows):
      </p><div class="itemizedlist"><ul><li><p>
            <code class="literal">@PostLoad</code> - Called after an entity instance is loaded from the database. Use this
            method to configure a <code class="literal">read</code> permission.
          </p></li><li><p>
            <code class="literal">@PrePersist</code> - Called before a new instance of the entity is inserted. Use this method
            to configure an <code class="literal">insert</code> permission.
          </p></li><li><p>
            <code class="literal">@PreUpdate</code> - Called before an entity is updated. Use this method
            to configure an <code class="literal">update</code> permission.
          </p></li><li><p>
            <code class="literal">@PreRemove</code> - Called before an entity is deleted. Use this method
            to configure a <code class="literal">delete</code> permission.
          </p></li></ul></div><p>
        Here's an example of how an entity would be configured to perform a security check for any <code class="literal">insert</code>
        operations.  Please note that the method is not required to do anything, the only important thing in regard to
        security is how it is annotated:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">PrePersist</span><span class="java_plain">&nbsp;@</span><span class="java_type">Restrict</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;prePersist</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Using /META-INF/orm.xml</h2><p>
            You can also specify the call back method in <code class="literal">/META-INF/orm.xml</code>:
         </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">entity-mappings</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence/orm&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence/orm&nbsp;http://java.sun.com/xml/ns/persistence/orm_1_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">entity</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Customer&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pre-persist</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">method-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;prePersist&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">entity</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">entity-mappings</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
            Of course, you still need to annotate the <code class="literal">prePersist()</code>
            method on <code class="literal">Customer</code> with <code class="literal">@Restrict</code>
         </p></div><p>
        And here's an example of an entity permission rule that checks if the authenticated user is allowed to insert
        a new <code class="literal">MemberBlog</code> record (from the seamspace example).  The entity for which the security
        check is being made is automatically inserted into the working memory (in this case <code class="literal">MemberBlog</code>):
      </p><pre class="programlisting">rule InsertMemberBlog
  no-loop
  activation-group "permissions"
when
  principal: Principal()
  memberBlog: MemberBlog(member : member -&gt; (member.getUsername().equals(principal.getName())))
  check: PermissionCheck(target == memberBlog, action == "insert", granted == false)
then
  check.grant();
end;</pre><p>
         This rule will grant the permission <code class="literal">memberBlog:insert</code> if the currently authenticated
         user (indicated by the <code class="literal">Principal</code> fact) has the same name as the member for which the
         blog entry is being created.  The "<code class="literal">principal: Principal()</code>" structure that can be seen in the
         example code is a variable binding - it binds the instance of the <code class="literal">Principal</code> object from the
         working memory (placed there during authentication) and assigns it to a variable called <code class="literal">principal</code>.
         Variable bindings allow the value to be referred to in other places, such as the following line which compares the 
         member's username to the <code class="literal">Principal</code> name.  For more details, please refer to the JBoss Rules documentation.
       </p><p>
         Finally, we need to install a listener class that integrates Seam security with
         your JPA provider.
       </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11106"/>15.6.5.1. Entity security with JPA</h4></div></div></div><p>
          Security checks for EJB3 entity beans are performed with an <code class="literal">EntityListener</code>.
          You can install this listener by using the following <code class="literal">META-INF/orm.xml</code> file:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">entity-mappings</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence/orm&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence/orm&nbsp;http://java.sun.com/xml/ns/persistence/orm_1_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit-metadata</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit-defaults</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">entity-listeners</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">entity-listener</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.EntitySecurityListener&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">entity-listeners</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit-defaults</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit-metadata</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">entity-mappings</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11119"/>15.6.5.2. Entity security with a Managed Hibernate Session</h4></div></div></div><p>
          If you are using a Hibernate <code class="literal">SessionFactory</code> configured via Seam,
          and are using annotations, or <code class="literal">orm.xml</code>, then you don't
          need to do anything special to use entity security.
        </p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11130"/>15.6.6. Typesafe Permission Annotations</h3></div></div></div><p>
        Seam provides a number of annotations that may be used as an alternative to <code class="literal">@Restrict</code>, which have
        the added advantage of providing compile-time safety as they don't support arbitrary EL expressions in the same way 
        that <code class="literal">@Restrict</code> does.
      </p><p>
        Out of the box, Seam comes with annotations for standard CRUD-based permissions, however it is a simple matter to 
        add your own.  The following annotations are provided in the <code class="literal">org.jboss.seam.annotations.security</code> package:
      </p><div class="itemizedlist"><ul><li><p>@Insert</p></li><li><p>@Read</p></li><li><p>@Update</p></li><li><p>@Delete</p></li></ul></div><p>
        To use these annotations, simply place them on the method or parameter for which you wish to perform a security check.
        If placed on a method, then they should specify a target class for which the permission will be checked.  Take the
        following example:
      </p><pre class="programlisting">  @Insert(Customer.class)
  public void createCustomer() {
    ...
  }</pre><p>
        In this example, a permission check will be performed for the user to ensure that they have the rights to create
        new <code class="literal">Customer</code> objects.  The target of the permission check will be <code class="literal">Customer.class</code>
        (the actual <code class="literal">java.lang.Class</code> instance itself), and the action is the lower case representation of the 
        annotation name, which in this example is <code class="literal">insert</code>.
      </p><p>
        It is also possible to annotate the parameters of a component method in the same way.  If this is done, then it is
        not required to specify a permission target (as the parameter value itself will be the target of the permission check):
      </p><pre class="programlisting">  public void updateCustomer(@Update Customer customer) {
    ...
  }</pre><p>
        To create your own security annotation, you simply need to annotate it with <code class="literal">@PermissionCheck</code>, for example:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Target</span><!-- <br/> --><span class="java_separator">({</span><!-- <br/> --><span class="java_plain">METHOD</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;PARAMETER</span><!-- <br/> --><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Documented</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inherited</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">PermissionCheck</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Promote</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_plain">&nbsp;value</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
        If you wish to override the default permission action name (which is the lower case version of the annotation name) with
        another value, you can specify it within the <code class="literal">@PermissionCheck</code> annotation:
      </p><pre class="programlisting">@PermissionCheck("upgrade")</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11195"/>15.6.7. Typesafe Role Annotations</h3></div></div></div><p>
        In addition to supporting typesafe permission annotation, Seam Security also provides typesafe role annotations that
        allow you to restrict access to component methods based on the role memberships of the currently authenticated user.
        Seam provides one such annotation out of the box, <code class="literal">org.jboss.seam.annotations.security.Admin</code>, used
        to restrict access to a method to users that are a member of the <code class="literal">admin</code> role (so long as your 
        own application supports such a role).  To create your own role annotations, simply meta-annotate them with
        <code class="literal">org.jboss.seam.annotations.security.RoleCheck</code>, like in the following example:
      </p><pre class="programlisting">@Target({METHOD})
@Documented
@Retention(RUNTIME)
@Inherited
@RoleCheck
public @interface User { 
}</pre><p>
        Any methods subsequently annotated with the <code class="literal">@User</code> annotation as shown in the above example
        will be automatically intercepted and the user checked for the membership of the corresponding role name
        (which is the lower case version of the annotation name, in this case <code class="literal">user</code>).
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11219"/>15.6.8. The Permission Authorization Model</h3></div></div></div><p>
        Seam Security provides an extensible framework for resolving application permissions.  The following class diagram
        shows an overview of the main components of the permission framework:
      </p><div class="mediaobject" align="center"><img src="images/security-permission-classdiagram.png" align="middle"/></div><p>
        The relevant classes are explained in more detail in the following sections.
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11231"/>15.6.8.1. PermissionResolver</h4></div></div></div><p>
          This is actually an interface, which provides methods for resolving individual object permissions.  Seam provides
          the following built-in <code class="literal">PermissionResolver</code> implementations, which are described in more detail later
          in the chapter:
        </p><div class="itemizedlist"><ul><li><p><code class="literal">RuleBasedPermissionResolver</code> - This permission resolver uses Drools to resolve rule-based
            permission checks.</p></li><li><p><code class="literal">PersistentPermissionResolver</code> - This permission resolver stores object permissions in a
            persistent store, such as a relational database.</p></li></ul></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e11250"/>15.6.8.1.1. Writing your own PermissionResolver</h5></div></div></div><p>
            It is very simple to implement your own permission resolver.  The <code class="literal">PermissionResolver</code>
            interface defines only two methods that must be implemented, as shown by the following table.  By deploying
            your own <code class="literal">PermissionResolver</code> implementation in your Seam project, it will be automatically
            scanned during deployment and registered with the default <code class="literal">ResolverChain</code>.
          </p><div class="table"><a id="d0e11264"/><p class="title"><b>Table 15.7. PermissionResolver interface</b></p><div class="table-contents"><table summary="PermissionResolver interface" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                    <p>Return type</p>
                  </th><th align="center">
                    <p>Method</p>
                  </th><th align="center">
                    <p>Description</p>
                  </th></tr></thead><tbody><tr><td>
                    <p>
                      <code class="literal">boolean</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">hasPermission(Object target, String action)</code>
                    </p>
                  </td><td>
                    <p>
                      This method must resolve whether the currently authenticated user (obtained via a call to
                      <code class="literal">Identity.getPrincipal()</code>) has the permission specified by the <code class="literal">target</code>
                      and <code class="literal">action</code> parameters.  It should return <code class="literal">true</code> if the user has
                      the permission, or <code class="literal">false</code> if they don't.
                    </p>
                  </td></tr><tr><td>
                    <p>
                      <code class="literal">void</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">filterSetByAction(Set&lt;Object&gt; targets, String action)</code>
                    </p>
                  </td><td>
                    <p>
                      This method should remove any objects from the specified set, that would 
                      return <code class="literal">true</code> if passed to the <code class="literal">hasPermission()</code> method with the 
                      same <code class="literal">action</code> parameter value.
                    </p>
                  </td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
              As they are cached in the user's session, any custom <code class="literal">PermissionResolver</code> 
              implementations must adhere to a couple of restrictions.  Firstly, they may not contain any 
              state that is finer-grained than session scope (and the scope of the component itself should
              either be application or session).  Secondly, they must not use dependency 
              injection as they may be accessed from multiple threads simultaneously.  In fact, for
              performance reasons it is recommended that they are annotated with 
              <code class="literal">@BypassInterceptors</code> to bypass Seam's interceptor stack altogether.
            </p></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11366"/>15.6.8.2. ResolverChain</h4></div></div></div><p>
          A <code class="literal">ResolverChain</code> contains an ordered list of <code class="literal">PermissionResolver</code>s, for the
          purpose of resolving object permissions for a particular object class or permission target.
        </p><p>
          The default <code class="literal">ResolverChain</code> consists of all permission resolvers discovered during
          application deployment.  The <code class="literal">org.jboss.seam.security.defaultResolverChainCreated</code>
          event is raised (and the <code class="literal">ResolverChain</code> instance passed as an event parameter) 
          when the default <code class="literal">ResolverChain</code> is created.  This allows additional resolvers that
          for some reason were not discovered during deployment to be added, or for resolvers that are in the 
          chain to be re-ordered or removed.
        </p><p>
          The following sequence diagram shows the interaction between the components of the permission framework during a
          permission check (explanation follows).  A permission check can originate from a number of possible sources,
          for example - the security interceptor, the <code class="literal">s:hasPermission</code> EL function, or via an API
          call to <code class="literal">Identity.checkPermission</code>:
        </p><div class="mediaobject" align="center"><img src="images/security-permission-sequence.png" align="middle"/></div><div class="itemizedlist"><ul><li><p>
              1. A permission check is initiated somewhere (either in code or via an EL
              expression) resulting in a call to <code class="literal">Identity.hasPermission()</code>.
            </p></li><li><p>
              1.1. <code class="literal">Identity</code> invokes 
              <code class="literal">PermissionMapper.resolvePermission()</code>, passing in the
              permission to be resolved.
            </p></li><li><p>
              1.1.1. <code class="literal">PermissionMapper</code> maintains a <code class="literal">Map</code> of 
              <code class="literal">ResolverChain</code> instances, keyed by class.  It uses this map
              to locate the correct <code class="literal">ResolverChain</code> for the permission's
              target object.  Once it has the correct <code class="literal">ResolverChain</code>, it
              retrieves the list of <code class="literal">PermissionResolver</code>s it contains via
              a call to <code class="literal">ResolverChain.getResolvers()</code>.
            </p></li><li><p>
              1.1.2. For each <code class="literal">PermissionResolver</code> in the <code class="literal">ResolverChain</code>,
              the <code class="literal">PermissionMapper</code> invokes its <code class="literal">hasPermission()</code> method,
              passing in the permission instance to be checked.  If any of the <code class="literal">PermissionResolver</code>s
              return <code class="literal">true</code>, then the permission check has succeeded and the 
              <code class="literal">PermissionMapper</code> also returns <code class="literal">true</code> to <code class="literal">Identity</code>.
              If none of the <code class="literal">PermissionResolver</code>s return true, then the permission check
              has failed.
            </p></li></ul></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11477"/>15.6.9. RuleBasedPermissionResolver</h3></div></div></div><p>
        One of the built-in permission resolvers provided by Seam, <code class="literal">RuleBasedPermissionResolver</code> 
        allows permissions to be evaluated based on a set of Drools (JBoss Rules) security rules.  A couple of the 
        advantages of using a rule engine are 1) a centralized location for the business logic that is used to
        evaluate user permissions, and 2) speed - Drools uses very efficient algorithms for evaluating large 
        numbers of complex rules involving multiple conditions.        
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11485"/>15.6.9.1. Requirements</h4></div></div></div><p>
          If using the rule-based permission features provided by Seam Security, the following jar files are required by Drools
          to be distributed with your project:
        </p><div class="itemizedlist"><ul><li><p>knowledge-api.jar</p></li><li><p>drools-compiler.jar</p></li><li><p>drools-core.jar</p></li><li><p>drools-decisiontables.jar</p></li><li><p>drools-templates.jar</p></li><li><p>janino.jar</p></li><li><p>antlr-runtime.jar</p></li><li><p>mvel2.jar</p></li></ul></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11515"/>15.6.9.2. Configuration</h4></div></div></div><p>
          The configuration for <code class="literal">RuleBasedPermissionResolver</code> requires that a Drools rule base is first
          configured in <code class="literal">components.xml</code>.  By default, it expects that the rule base is named
          <code class="literal">securityRules</code>, as per the following example:       
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">components</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/components&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:core</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/core&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:security</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/security&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:drools</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/drools&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/core&nbsp;http://jboss.org/schema/seam/core-2.3.xsd</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://jboss.org/schema/seam/components&nbsp;http://jboss.org/schema/seam/components-2.3.xsd</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://jboss.org/schema/seam/drools&nbsp;http://jboss.org/schema/seam/drools-2.3.xsd</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://jboss.org/schema/seam/security&nbsp;http://jboss.org/schema/seam/security-2.3.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:rule-base</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;securityRules&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:rule-files</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/META-INF/security.drl</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:rule-files</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:rule-base</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">components</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
          The default rule base name can be overridden by specifying the <code class="literal">security-rules</code> 
          property for <code class="literal">RuleBasedPermissionResolver</code>:
        </p><pre class="programlisting">
  &lt;security:rule-based-permission-resolver security-rules="#{prodSecurityRules}"/&gt;</pre><p>
          Once the <code class="literal">RuleBase</code> component is configured, it's time to write the security rules.
        </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11546"/>15.6.9.3. Writing Security Rules</h4></div></div></div><p>
          The first step to writing security rules is to create a new rule file in the <code class="literal">/META-INF</code>
          directory of your application's jar file.  Usually this file would be named something like 
          <code class="literal">security.drl</code>, however you can name it whatever you like as long as it is configured
          correspondingly in <code class="literal">components.xml</code>.
        </p><p>
          So what should the security rules file contain?  At this stage it might be a good idea to at least skim
          through the Drools documentation, however to get started here's an extremely simple example:
        </p><pre class="programlisting">package MyApplicationPermissions;
  
  import org.jboss.seam.security.permission.PermissionCheck;
  import org.jboss.seam.security.Role;
  
  rule CanUserDeleteCustomers
  when
    c: PermissionCheck(target == "customer", action == "delete")
    Role(name == "admin")
  then
    c.grant();
  end</pre><p>
          Let's break this down step by step.  The first thing we see is the package declaration.  A package in Drools
          is essentially a collection of rules.  The package name can be anything you want - it doesn't relate
          to anything else outside the scope of the rule base.
        </p><p>
          The next thing we can notice is a couple of import statements for the <code class="literal">PermissionCheck</code>
          and <code class="literal">Role</code> classes. These imports inform the rules engine that we'll be referencing
          these classes within our rules.
        </p><p>
          Finally we have the code for the rule.  Each rule within a package should be given a unique name (usually
          describing the purpose of the rule).  In this case our rule is called <code class="literal">CanUserDeleteCustomers</code>
          and will be used to check whether a user is allowed to delete a customer record.
        </p><p>
          Looking at the body of the rule definition we can notice two distinct sections.  Rules have what is known
          as a left hand side (LHS) and a right hand side (RHS).  The LHS consists of the conditional part of the
          rule, i.e. a list of conditions which must be satisfied for the rule to fire.  The LHS is represented by
          the <code class="literal">when</code> section.  The RHS is the consequence, or action section of the rule that will
          only be fired if all of the conditions in the LHS are met.  The RHS is represented by the
          <code class="literal">then</code> section.  The end of the rule is denoted by the <code class="literal">end</code> line.
        </p><p>
          If we look at the LHS of the rule, we see two conditions listed there.  Let's examine the first condition:
        </p><pre class="programlisting">c: PermissionCheck(target == "customer", action == "delete")</pre><p>
          In plain english, this condition is stating that there must exist a <code class="literal">PermissionCheck</code> object
          with a <code class="literal">target</code> property equal to "customer", and an <code class="literal">action</code> property equal
          to "delete" within the working memory.
        </p><p>
          So what is the working memory? Also known as a "stateful session" in Drools terminology, the working memory 
          is a session-scoped object that contains the contextual information that is required by the rules engine to 
          make a decision about a permission check. Each time the <code class="literal">hasPermission()</code> method is called, 
          a temporary <code class="literal">PermissionCheck</code> object, or <span class="emphasis"><em>Fact</em></span>, is inserted into the 
          working memory.  This <code class="literal">PermissionCheck</code> corresponds exactly to the permission that is being 
          checked, so for example if you call <code class="literal">hasPermission("account", "create")</code> then a 
          <code class="literal">PermissionCheck</code> object with a <code class="literal">target</code> equal to "account" and 
          <code class="literal">action</code> equal to "create" will be inserted into the working memory for the duration of the 
          permission check.
        </p><p>
          Besides the <code class="literal">PermissionCheck</code> facts, there is also a <code class="literal">org.jboss.seam.security.Role</code>
          fact for each of the roles that the authenticated user is a member of.  These <code class="literal">Role</code> facts 
          are synchronized with the user's authenticated roles at the beginning of every permission check.  As a consequence, 
          any <code class="literal">Role</code> object that is inserted into the working memory during the course of a permission
          check will be removed before the next permission check occurs, if the authenticated user is not actually a member of
          that role.  Besides the <code class="literal">PermissionCheck</code> and <code class="literal">Role</code> facts, the working
          memory also contains the <code class="literal">java.security.Principal</code> object that was created as a result of
          the authentication process.  
        </p><p>
          It is also possible to insert additional long-lived facts into the working  memory by calling 
          <code class="literal">RuleBasedPermissionResolver.instance().getSecurityContext().insert()</code>,
          passing the object as a parameter.  The exception to this is <code class="literal">Role</code> objects, which as
          already discussed are synchronized at the start of each permission check.
        </p><p>
          Getting back to our simple example, we can also notice that the first line of our LHS is prefixed with
          <code class="literal">c:</code>.  This is a variable binding, and is used to refer back to the object that is
          matched by the condition (in this case, the <code class="literal">PermissionCheck</code>).  Moving on to the 
          second line of our LHS, we see this:
        </p><pre class="programlisting">Role(name == "admin")</pre><p>
          This condition simply states that there must be a <code class="literal">Role</code> object with a 
          <code class="literal">name</code> of "admin" within the working memory.  As already mentioned, user roles are inserted into 
          the working memory at the beginning of each permission check.  So, putting both conditions together, this 
          rule is essentially saying "I will fire if you are checking for the <code class="literal">customer:delete</code> 
          permission and the user is a member of the <code class="literal">admin</code> role".
        </p><p>
          So what is the consequence of the rule firing?  Let's take a look at the RHS of the rule:
        </p><pre class="programlisting">c.grant()</pre><p>
          The RHS consists of Java code, and in this case is invoking the <code class="literal">grant()</code>
          method of the <code class="literal">c</code> object, which as already mentioned is a variable binding
          for the <code class="literal">PermissionCheck</code> object.  Besides the <code class="literal">name</code> and
          <code class="literal">action</code> properties of the <code class="literal">PermissionCheck</code> object, there
          is also a <code class="literal">granted</code> property which is initially set to <code class="literal">false</code>.
          Calling <code class="literal">grant()</code> on a <code class="literal">PermissionCheck</code> sets the
          <code class="literal">granted</code> property to <code class="literal">true</code>, which means that the permission
          check was successful, allowing the user to carry out whatever action the permission check was
          intended for.
        </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11728"/>15.6.9.4. Non-String permission targets</h4></div></div></div><p>
          So far we have only seen permission checks for String-literal permission targets.  It is of course also
          possible to write security rules for permission targets of more complex types.  For example, let's say that you wish
          to write a security rule to allow your users to create blog comments.  The following rule demonstrates
          how this may be expressed, by requiring the target of the permission check to be an instance of
          <code class="literal">MemberBlog</code>, and also requiring that the currently authenticated user is a member of the
          <code class="literal">user</code> role:
        </p><pre class="programlisting">rule CanCreateBlogComment
  no-loop
  activation-group "permissions"
when
  blog: MemberBlog()
  check: PermissionCheck(target == blog, action == "create", granted == false)
  Role(name == "user")
then
  check.grant();
end
</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11741"/>15.6.9.5. Wildcard permission checks</h4></div></div></div><p>
          It is possible to implement a wildcard permission check (which allows all actions for a given permission
          target), by omitting the <code class="literal">action</code> constraint for the <code class="literal">PermissionCheck</code> in
          your rule, like this:
        </p><pre class="programlisting">rule CanDoAnythingToCustomersIfYouAreAnAdmin
when
  c: PermissionCheck(target == "customer")
  Role(name == "admin")
then
  c.grant();
end;
        </pre><p>
          This rule allows users with the <code class="literal">admin</code> role to perform <span class="emphasis"><em>any</em></span> action for
          any <code class="literal">customer</code> permission check.
        </p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11765"/>15.6.10. PersistentPermissionResolver</h3></div></div></div><p>
        Another built-in permission resolver provided by Seam, <code class="literal">PersistentPermissionResolver</code>
        allows permissions to be loaded from persistent storage, such as a relational database.  This permission 
        resolver provides ACL style instance-based security, allowing for specific object permissions to be assigned
        to individual users and roles.  It also allows for persistent, arbitrarily-named permission targets (not 
        necessarily object/class based) to be assigned in the same way.
      </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11773"/>15.6.10.1. Configuration</h4></div></div></div><p>
          Before it can be used, <code class="literal">PersistentPermissionResolver</code> must be configured with a
          valid <code class="literal">PermissionStore</code> in <code class="literal">components.xml</code>.  If not configured,
          it will attempt to use the default permission store, <code class="literal">JpaIdentityStore</code> (see section
          further down for details).  To use a permission store other than the default, configure the
          <code class="literal">permission-store</code> property as follows:
        </p><pre class="programlisting">  &lt;security:persistent-permission-resolver permission-store="#{myCustomPermissionStore}"/&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11795"/>15.6.10.2. Permission Stores</h4></div></div></div><p>
          A permission store is required for <code class="literal">PersistentPermissionResolver</code> to connect to the
          backend storage where permissions are persisted.  Seam provides one <code class="literal">PermissionStore</code>
          implementation out of the box, <code class="literal">JpaPermissionStore</code>, which is used to store
          permissions inside a relational database.  It is possible to write your own permission store
          by implementing the <code class="literal">PermissionStore</code> interface, which defines the following
          methods:
        </p><div class="table"><a id="d0e11812"/><p class="title"><b>Table 15.8. PermissionStore interface</b></p><div class="table-contents"><table summary="PermissionStore interface" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                  <p>Return type</p>
                </th><th align="center">
                  <p>Method</p>
                </th><th align="center">
                  <p>Description</p>
                </th></tr></thead><tbody><tr><td>
                  <p>
                    <code class="literal">List&lt;Permission&gt;</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">listPermissions(Object target)</code>
                  </p>
                </td><td>
                  <p>
                    This method should return a <code class="literal">List</code> of <code class="literal">Permission</code> objects 
                    representing all the permissions granted for the specified target object.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">List&lt;Permission&gt;</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">listPermissions(Object target, String action)</code>
                  </p>
                </td><td>
                  <p>
                    This method should return a <code class="literal">List</code> of <code class="literal">Permission</code> objects 
                    representing all the permissions with the specified action, granted for the specified target object.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">List&lt;Permission&gt;</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">listPermissions(Set&lt;Object&gt; targets, String action)</code>
                  </p>
                </td><td>
                  <p>
                    This method should return a <code class="literal">List</code> of <code class="literal">Permission</code> objects 
                    representing all the permissions with the specified action, granted for the specified set of
                    target objects.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">boolean</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">grantPermission(Permission)</code>
                  </p>
                </td><td>
                  <p>
                    This method should persist the specified <code class="literal">Permission</code> object to the backend
                    storage, returning true if successful.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">boolean</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">grantPermissions(List&lt;Permission&gt; permissions)</code>
                  </p>
                </td><td>
                  <p>
                    This method should persist all of the <code class="literal">Permission</code> objects contained in the
                    specified <code class="literal">List</code>, returning true if successful.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">boolean</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">revokePermission(Permission permission)</code>
                  </p>
                </td><td>
                  <p>
                    This method should remove the specified <code class="literal">Permission</code> object from persistent storage.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">boolean</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">revokePermissions(List&lt;Permission&gt; permissions)</code>
                  </p>
                </td><td>
                  <p>
                    This method should remove all of the <code class="literal">Permission</code> objects in the specified list
                    from persistent storage.
                  </p>
                </td></tr><tr><td>
                  <p>
                    <code class="literal">List&lt;String&gt;</code>
                  </p>
                </td><td>
                  <p>
                    <code class="literal">listAvailableActions(Object target)</code>
                  </p>
                </td><td>
                  <p>
                    This method should return a list of all the available actions (as Strings) for the class of the 
                    specified target object.  It is used in conjunction with permission management to build the user
                    interface for granting specific class permissions (see section further down).
                  </p>
                </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e12046"/>15.6.10.3. JpaPermissionStore</h4></div></div></div><p>
          This is the default <code class="literal">PermissionStore</code> implementation (and the only one provided by Seam), which 
          uses a relational database to store permissions.  Before it can be used it must be configured with either one or 
          two entity classes for storing user and role permissions.  These entity classes must be annotated with a special 
          set of security annotations to configure which properties of the entity correspond to various aspects of the 
          permissions being stored.
        </p><p>
          If you wish to use the same entity (i.e. a single database table) to store both user and role permissions, then
          only the <code class="literal">user-permission-class</code> property is required to be configured.  If you wish to use
          separate tables for storing user and role permissions, then in addition to the <code class="literal">user-permission-class</code>
          property you must also configure the <code class="literal">role-permission-class</code> property.
        </p><p>For example, to configure a single entity class to store both user and role permissions:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:jpa-permission-store</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">user-permission-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.model.AccountPermission&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>To configure separate entity classes for storing user and role permissions:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:jpa-permission-store</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">user-permission-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.model.UserPermission&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">role-permission-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.model.RolePermission&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e12073"/>15.6.10.3.1. Permission annotations</h5></div></div></div><p>
            As mentioned, the entity classes that contain the user and role permissions must be configured with a
            special set of annotations, contained within the <code class="literal">org.jboss.seam.annotations.security.permission</code> package.
            The following table lists each of these annotations along with a description of how they are used:
          </p><div class="table"><a id="d0e12081"/><p class="title"><b>Table 15.9. Entity Permission annotations</b></p><div class="table-contents"><table summary="Entity Permission annotations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                    <p>Annotation</p>
                  </th><th align="center">
                    <p>Target</p>
                  </th><th align="center">
                    <p>Description</p>
                  </th></tr></thead><tbody><tr><td>
                    <p>
                      <code class="literal">@PermissionTarget</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">FIELD,METHOD</code>
                    </p>
                  </td><td>
                    <p>
                      This annotation identifies the property of the entity that will contain the permission target.  The property
                      should be of type <code class="literal">java.lang.String</code>.
                    </p>
                  </td></tr><tr><td>
                    <p>
                      <code class="literal">@PermissionAction</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">FIELD,METHOD</code>
                    </p>
                  </td><td>
                    <p>
                      This annotation identifies the property of the entity that will contain the permission action.  The property
                      should be of type <code class="literal">java.lang.String</code>.
                    </p>
                  </td></tr><tr><td>
                    <p>
                      <code class="literal">@PermissionUser</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">FIELD,METHOD</code>
                    </p>
                  </td><td>
                    <p>
                      This annotation identifies the property of the entity that will contain the recipient user for the permission. It should
                      be of type <code class="literal">java.lang.String</code> and contain the user's username.
                    </p>
                  </td></tr><tr><td>
                    <p>
                      <code class="literal">@PermissionRole</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">FIELD,METHOD</code>
                    </p>
                  </td><td>
                    <p>
                      This annotation identifies the property of the entity that will contain the recipient role for the permission. It should
                      be of type <code class="literal">java.lang.String</code> and contain the role name.
                    </p>
                  </td></tr><tr><td>
                    <p>
                      <code class="literal">@PermissionDiscriminator</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">FIELD,METHOD</code>
                    </p>
                  </td><td>
                    <p>
                      This annotation should be used when the same entity/table is used to store both user and role permissions.  It identifies
                      the property of the entity that is used to discriminate between user and role permissions.  By default, if the column
                      value contains the string literal <code class="literal">user</code>, then the record will be treated as a user permission.  If it
                      contains the string literal <code class="literal">role</code>, then it will be treated as a role permission.  It is also possible
                      to override these defaults by specifying the <code class="literal">userValue</code> and <code class="literal">roleValue</code> properties
                      within the annotation.  For example, to use <code class="literal">u</code> and <code class="literal">r</code> instead of <code class="literal">user</code>
                      and <code class="literal">role</code>, the annotation would be written like this:
                    </p>
                    
                    <pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">PermissionDiscriminator</span>
<!--  --><br/><span class="java_separator">(</span><span class="java_plain">userValue</span><span class="java_operator">=</span><span class="java_literal">&quot;u&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;roleValue</span><span class="java_operator">=</span><span class="java_literal">&quot;r&quot;</span><span class="java_separator">)</span></pre>
                  </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e12255"/>15.6.10.3.2. Example Entity</h5></div></div></div><p>
            Here is an example of an entity class that is used to store both user and role permissions.  The following class can be found
            inside the SeamSpace example:
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountPermission</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;permissionId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;recipient</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;target</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;action</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;discriminator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getPermissionId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;permissionId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setPermissionId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;permissionId</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">permissionId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;permissionId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PermissionUser</span><span class="java_plain">&nbsp;@</span><span class="java_type">PermissionRole</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getRecipient</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;recipient</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRecipient</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;recipient</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">recipient&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;recipient</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PermissionTarget</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTarget</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;target</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setTarget</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;target</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">target&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;target</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PermissionAction</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAction</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;action</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setAction</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;action</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">action&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;action</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PermissionDiscriminator</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDiscriminator</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;discriminator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setDiscriminator</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;discriminator</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">discriminator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;discriminator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>
            As can be seen in the above example, the <code class="literal">getDiscriminator()</code> method has been annotated
            with the <code class="literal">@PermissionDiscriminator</code> annotation, to allow <code class="literal">JpaPermissionStore</code> to
            determine which records represent user permissions and which represent role permissions.  In addition, it
            can also be seen that the <code class="literal">getRecipient()</code> method is annotated with both 
            <code class="literal">@PermissionUser</code> and <code class="literal">@PermissionRole</code> annotations.  This is perfectly valid,
            and simply means that the <code class="literal">recipient</code> property of the entity will either contain the name
            of the user or the name of the role, depending on the value of the <code class="literal">discriminator</code> property.
          </p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e12288"/>15.6.10.3.3. Class-specific Permission Configuration</h5></div></div></div><p>
            A further set of class-specific annotations can be used to configure a specific set of allowable permissions
            for a target class.  These permissions can be found in the <code class="literal">org.jboss.seam.annotation.security.permission</code>
            package:
          </p><div class="table"><a id="d0e12296"/><p class="title"><b>Table 15.10. Class Permission Annotations</b></p><div class="table-contents"><table summary="Class Permission Annotations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                    <p>Annotation</p>
                  </th><th align="center">
                    <p>Target</p>
                  </th><th align="center">
                    <p>Description</p>
                  </th></tr></thead><tbody><tr><td>
                    <p>
                      <code class="literal">@Permissions</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">TYPE</code>
                    </p>
                  </td><td>
                    <p>
                      A container annotation, this annotation may contain an array of <code class="literal">@Permission</code> annotations.
                    </p>
                  </td></tr><tr><td>
                    <p>
                      <code class="literal">@Permission</code>
                    </p>
                  </td><td>
                    <p>
                      <code class="literal">TYPE</code>
                    </p>
                  </td><td>
                    <p>
                      This annotation defines a single allowable permission action for the target class.  Its <code class="literal">action</code>
                      property must be specified, and an optional <code class="literal">mask</code> property may also be specified if permission
                      actions are to be persisted as bitmasked values (see next section).
                    </p>
                  </td></tr></tbody></table></div></div><br class="table-break"/><p>
            Here's an example of the above annotations in action.  The following class can also be found in the SeamSpace example:
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Permissions</span><!-- <br/> --><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Permission</span><span class="java_separator">(</span><span class="java_plain">action&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;view&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Permission</span><span class="java_separator">(</span><span class="java_plain">action&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;comment&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MemberImage</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span></pre><p>
            This example demonstrates how two allowable permission actions, <code class="literal">view</code> and <code class="literal">comment</code> 
            can be declared for the entity class <code class="literal">MemberImage</code>.
          </p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e12389"/>15.6.10.3.4. Permission masks</h5></div></div></div><p>
            By default, multiple permissions for the same target object and recipient will be persisted as a single database record,
            with the <code class="literal">action</code> property/column containing a comma-separated list of the granted actions.  To reduce
            the amount of physical storage required to persist a large number of permissions, it is possible to use a bitmasked
            integer value (instead of a comma-separated list) to store the list of permission actions.
          </p><p>
            For example, if recipient "Bob" is granted both the <code class="literal">view</code> and <code class="literal">comment</code> permissions
            for a particular <code class="literal">MemberImage</code> (an entity bean) instance, then by default the <code class="literal">action</code> property of the
            permission entity will contain "<code class="literal">view,comment</code>", representing the two granted permission actions.  
            Alternatively, if using bitmasked values for the permission actions, as defined like so:
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Permissions</span><!-- <br/> --><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Permission</span><span class="java_separator">(</span><span class="java_plain">action&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;view&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mask&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Permission</span><span class="java_separator">(</span><span class="java_plain">action&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;comment&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mask&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MemberImage</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span></pre><p>
            The <code class="literal">action</code> property will instead simply contain "3" (with both the 1 bit and 2 bit switched on).  Obviously
            for a large number of allowable actions for any particular target class, the storage required for the permission records
            is greatly reduced by using bitmasked actions.
          </p><p>
            Obviously, it is very important that the <code class="literal">mask</code> values specified are powers of 2.
          </p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e12426"/>15.6.10.3.5. Identifier Policy</h5></div></div></div><p>
            When storing or looking up permissions, <code class="literal">JpaPermissionStore</code> must be able to uniquely identify specific
            object instances to effectively operate on its permissions.  To achieve this, an <span class="emphasis"><em>identifier strategy</em></span> 
            may be assigned to each target class for the generation of unique identifier values.  Each identifier strategy
            implementation knows how to generate unique identifiers for a particular type of class, and it is a simple matter to 
            create new identifier strategies.
          </p><p>
            The <code class="literal">IdentifierStrategy</code> interface is very simple, declaring only two methods:
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">IdentifierStrategy</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;canIdentify</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_plain">&nbsp;targetClass</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getIdentifier</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;target</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
            The first method, <code class="literal">canIdentify()</code> simply returns <code class="literal">true</code> if the identifier strategy
            is capable of generating a unique identifier for the specified target class.  The second method, 
            <code class="literal">getIdentifier()</code> returns the unique identifier value for the specified target object.
          </p><p>
            Seam provides two <code class="literal">IdentifierStrategy</code> implementations, <code class="literal">ClassIdentifierStrategy</code>
            and <code class="literal">EntityIdentifierStrategy</code> (see next sections for details).
          </p><p>
            To explicitly configure a specific identifier strategy to use for a particular class, it should be annotated with
            <code class="literal">org.jboss.seam.annotations.security.permission.Identifier</code>, and the value should be set to
            a concrete implementation of the <code class="literal">IdentifierStrategy</code> interface.  An optional <code class="literal">name</code>
            property can also be specified, the effect of which is dependent upon the actual <code class="literal">IdentifierStrategy</code>
            implementation used.
          </p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e12480"/>15.6.10.3.6. ClassIdentifierStrategy</h5></div></div></div><p>
            This identifier strategy is used to generate unique identifiers for classes, and will use the value of the 
            <code class="literal">name</code> (if specified) in the <code class="literal">@Identifier</code> annotation.  If there is no
            <code class="literal">name</code> property provided, then it will attempt to use the component name of the class
            (if the class is a Seam component), or as a last resort it will create an identifier based on the name
            of the class (excluding the package name).  For example, the identifier for the following class will
            be "<code class="literal">customer</code>":
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Identifier</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;customer&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span></pre><p>
            The identifier for the following class will be "<code class="literal">customerAction</code>":
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;customerAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomerAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span></pre><p>
            Finally, the identifier for the following class will be "<code class="literal">Customer</code>":
          </p><pre class="programlisting">public class Customer { </pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e12513"/>15.6.10.3.7. EntityIdentifierStrategy</h5></div></div></div><p>
            This identifier strategy is used to generate unique identifiers for entity beans.  It does so by
            concatenating the entity name (or otherwise configured name) with a string representation of the
            primary key value of the entity.  The rules for generating the name section of the identifier are 
            similar to <code class="literal">ClassIdentifierStrategy</code>.  The primary key value (i.e. the 
            <span class="emphasis"><em>id</em></span> of the entity) is obtained using the <code class="literal">PersistenceProvider</code>
            component, which is able to correctly determine the value regardless of which persistence implementation
            is used within the Seam application.  For entities not annotated with <code class="literal">@Entity</code>, it is
            necessary to explicitly configure the identifier strategy on the entity class itself, for example:
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Identifier</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">value&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">EntityIdentifierStrategy</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span></pre><p>
            For an example of the type of identifier values generated, assume we have the following entity class:
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;firstName</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lastName</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getFirstName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;firstName</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setFirstName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;firstName</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">firstName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstName</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getLastName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;lastName</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setLastName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;lastName</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">lastName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;lastName</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
            For a <code class="literal">Customer</code> instance with an <code class="literal">id</code> value of <code class="literal">1</code>,
            the value of the identifier would be "<code class="literal">Customer:1</code>".  If the entity class is annotated
            with an explicit identifier name, like so:
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Identifier</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cust&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span></pre><p>
            Then a <code class="literal">Customer</code> with an <code class="literal">id</code> value of <code class="literal">123</code>
            would have an identifier value of "<code class="literal">cust:123</code>".
          </p></div></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12566"/>15.7. Permission Management</h2></div></div></div><p>
      In much the same way that Seam Security provides an Identity Management API for the management of users and roles,
      it also provides a Permissions Management API for the management of persistent user permissions, via the
      <code class="literal">PermissionManager</code> component.
    </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12574"/>15.7.1. PermissionManager</h3></div></div></div><p>
        The <code class="literal">PermissionManager</code> component is an application-scoped Seam component that provides a number of 
        methods for managing permissions.  Before it can be used, it must be configured with a permission store (although by
        default it will attempt to use <code class="literal">JpaPermissionStore</code> if it is available).  To explicitly configure a
        custom permission store, specify the <code class="literal">permission-store</code> property in components.xml:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">security:permission-manager</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">permission-store</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{ldapPermissionStore}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>
        The following table describes each of the available methods provided by <code class="literal">PermissionManager</code>: 
      </p><div class="table"><a id="d0e12595"/><p class="title"><b>Table 15.11. PermissionManager API methods</b></p><div class="table-contents"><table summary="PermissionManager API methods" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                <p>Return type</p>
              </th><th align="center">
                <p>Method</p>
              </th><th align="center">
                <p>Description</p>
              </th></tr></thead><tbody><tr><td>
                <p>
                  <code class="literal">List&lt;Permission&gt;</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">listPermissions(Object target, String action)</code>
                </p>
              </td><td>
                <p>
                  Returns a list of <code class="literal">Permission</code> objects representing all of the permissions that
                  have been granted for the specified target and action.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">List&lt;Permission&gt;</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">listPermissions(Object target)</code>
                </p>
              </td><td>
                <p>
                  Returns a list of <code class="literal">Permission</code> objects representing all of the permissions that
                  have been granted for the specified target and action.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">grantPermission(Permission permission)</code>
                </p>
              </td><td>
                <p>
                  Persists (grants) the specified <code class="literal">Permission</code> to the backend permission store.  
                  Returns true if the operation was successful.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">grantPermissions(List&lt;Permission&gt; permissions)</code>
                </p>
              </td><td>
                <p>
                  Persists (grants) the specified list of <code class="literal">Permission</code>s to the backend permission store.  
                  Returns true if the operation was successful.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">revokePermission(Permission permission)</code>
                </p>
              </td><td>
                <p>
                  Removes (revokes) the specified <code class="literal">Permission</code> from the backend permission store.  
                  Returns true if the operation was successful.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">boolean</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">revokePermissions(List&lt;Permission&gt; permissions)</code>
                </p>
              </td><td>
                <p>
                  Removes (revokes) the specified list of <code class="literal">Permission</code>s from the backend permission store.  
                  Returns true if the operation was successful.
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">List&lt;String&gt;</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">listAvailableActions(Object target)</code>
                </p>
              </td><td>
                <p>
                  Returns a list of the available actions for the specified target object.  The actions that this
                  method returns are dependent on the <code class="literal">@Permission</code> annotations configured on the 
                  target object's class.
                </p>
              </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12795"/>15.7.2. Permission checks for PermissionManager operations</h3></div></div></div><p>
        Invoking the methods of <code class="literal">PermissionManager</code> requires that the currently-authenticated user
        has the appropriate authorization to perform that management operation.  The following table lists the required
        permissions that the current user must have.
      </p><div class="table"><a id="d0e12803"/><p class="title"><b>Table 15.12. Permission Management Security Permissions</b></p><div class="table-contents"><table summary="Permission Management Security Permissions" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">
                <p>Method</p>
              </th><th align="center">
                <p>Permission Target</p>
              </th><th align="center">
                <p>Permission Action</p>
              </th></tr></thead><tbody><tr><td>
                <p>
                  <code class="literal">listPermissions()</code>
                </p>
              </td><td>
                <p>
                  The specified <code class="literal">target</code>
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.read-permissions</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">grantPermission()</code>
                </p>
              </td><td>
                <p>
                  The target of the specified <code class="literal">Permission</code>, or each of the targets
                  for the specified list of <code class="literal">Permission</code>s (depending on which method is
                  called).
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.grant-permission</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">grantPermission()</code>
                </p>
              </td><td>
                <p>
                  The target of the specified <code class="literal">Permission</code>.
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.grant-permission</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">grantPermissions()</code>
                </p>
              </td><td>
                <p>
                  Each of the targets of the specified list of <code class="literal">Permission</code>s.
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.grant-permission</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">revokePermission()</code>
                </p>
              </td><td>
                <p>
                  The target of the specified <code class="literal">Permission</code>.
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.revoke-permission</code>
                </p>
              </td></tr><tr><td>
                <p>
                  <code class="literal">revokePermissions()</code>
                </p>
              </td><td>
                <p>
                  Each of the targets of the specified list of <code class="literal">Permission</code>s.
                </p>
              </td><td>
                <p>
                  <code class="literal">seam.revoke-permission</code>
                </p>
              </td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12981"/>15.8. SSL Security</h2></div></div></div><p>
      Seam includes basic support for serving sensitive pages via the HTTPS protocol.  This is easily
      configured by specifying a <code class="literal">scheme</code> for the page in <code class="literal">pages.xml</code>.
      The following example shows how the view <code class="literal">/login.xhtml</code> is configured to use
      HTTPS:
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">page</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/login.xhtml&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">scheme</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;https&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
      This configuration is automatically extended to both <code class="literal">s:link</code> and
      <code class="literal">s:button</code> JSF controls, which (when specifying the <code class="literal">view</code>)
      will also render the link using the correct protocol.  Based on the previous example, the following
      link will use the HTTPS protocol because <code class="literal">/login.xhtml</code> is configured to use it:
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">s:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/login.xhtml&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Login&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
      Browsing directly to a view when using the <span class="emphasis"><em>incorrect</em></span> protocol will cause a
      redirect to the same view using the <span class="emphasis"><em>correct</em></span> protocol.  For example, browsing
      to a page that has <code class="literal">scheme="https"</code> using HTTP will cause a redirect to the same
      page using HTTPS.
    </p><p>
      It is also possible to configure a <span class="emphasis"><em>default scheme</em></span> for all pages. This is useful
      if you wish to use HTTPS for a only few pages. If no default scheme is specified then the normal
      behavior is to continue use the current scheme. So once the user accessed a page that required
      HTTPS, then HTTPS would continue to be used after the user navigated away to other non-HTTPS pages.
      (While this is good for security, it is not so great for performance!). To define HTTP as the
      default <code class="literal">scheme</code>, add this line to <code class="literal">pages.xml</code>:
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">page</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;*&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">scheme</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
      Of course, if <span class="emphasis"><em>none</em></span> of the pages in your application use HTTPS then it is not
      required to specify a default scheme.
    </p><p>
      You may configure Seam to automatically invalidate the current HTTP session each time the scheme
      changes. Just add this line to <code class="literal">components.xml</code>:
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">web:session</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">invalidate-on-scheme-change</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
      This option helps make your system less vulnerable to sniffing of the session id or leakage of
      sensitive data from pages using HTTPS to other pages using HTTP.
    </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13051"/>15.8.1. Overriding the default ports</h3></div></div></div><p>
        If you wish to configure the HTTP and HTTPS ports manually, they may be configured in 
        <code class="literal">pages.xml</code> by specifying the <code class="literal">http-port</code> and
        <code class="literal">https-port</code> attributes on the <code class="literal">pages</code> element:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pages</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/pages&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/pages&nbsp;http://jboss.org/schema/seam/pages-2.3.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">no-conversation-view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/home.xhtml&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">login-view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/login.xhtml&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">http-port</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;8080&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">https-port</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;8443&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13070"/>15.9. CAPTCHA</h2></div></div></div><p>
      Though strictly not part of the security API, Seam provides a built-in CAPTCHA (<span class="emphasis"><em>C</em></span>ompletely
      <span class="emphasis"><em>A</em></span>utomated <span class="emphasis"><em>P</em></span>ublic <span class="emphasis"><em>T</em></span>uring test to tell
      <span class="emphasis"><em>C</em></span>omputers and <span class="emphasis"><em>H</em></span>umans <span class="emphasis"><em>A</em></span>part) algorithm to
      prevent automated processes from interacting with your application.
    </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13096"/>15.9.1. Configuring the CAPTCHA Servlet</h3></div></div></div><p>
        To get up and running, it is necessary to configure the Seam Resource Servlet, which will provide the Captcha
        challenge images to your pages.  This requires the following entry in <code class="literal">web.xml</code>:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Seam&nbsp;Resource&nbsp;Servlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.servlet.SeamResourceServlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Seam&nbsp;Resource&nbsp;Servlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/seam/resource/*</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13106"/>15.9.2. Adding a CAPTCHA to a form</h3></div></div></div><p>
        Adding a CAPTCHA challenge to a form is extremely easy. Here's an example:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:graphicImage</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/seam/resource/captcha&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;verifyCaptcha&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{captcha.response}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">required</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">s:validate</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:inputText</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:message</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;verifyCaptcha&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
        That's all there is to it.  The <code class="literal">graphicImage</code> control displays the CAPTCHA challenge,
        and the <code class="literal">inputText</code> receives the user's response. The response is automatically
        validated against the CAPTCHA when the form is submitted.
      </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13121"/>15.9.3. Customising the CAPTCHA algorithm</h3></div></div></div><p>
        You may customize the CAPTCHA algorithm by overriding the built-in component:
      </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;org.jboss.seam.captcha.captcha&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Scope</span><span class="java_separator">(</span><span class="java_plain">SESSION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">HitchhikersCaptcha</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Captcha</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span><span class="java_plain">&nbsp;@</span><span class="java_type">Create</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;init</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setChallenge</span><span class="java_separator">(</span><span class="java_literal">&quot;What&nbsp;is&nbsp;the&nbsp;answer&nbsp;to&nbsp;life,&nbsp;the&nbsp;universe&nbsp;and&nbsp;everything?&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setCorrectResponse</span><span class="java_separator">(</span><span class="java_literal">&quot;42&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BufferedImage</span><span class="java_plain">&nbsp;renderChallenge</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">BufferedImage</span><span class="java_plain">&nbsp;img&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">.</span><span class="java_plain">renderChallenge</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img</span><span class="java_separator">.</span><span class="java_plain">getGraphics</span><span class="java_separator">().</span><span class="java_plain">drawOval</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">3</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">60</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">add&nbsp;an&nbsp;obscuring&nbsp;decoration</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;img</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13128"/>15.10. Security Events</h2></div></div></div><p>
      The following table describes a number of events (see <a class="xref" href="events.html" title="Chapter 6. Events, interceptors and exception handling">Chapter 6, <i>Events, interceptors and exception handling</i></a>) raised by Seam Security
      in response to certain security-related events.
    </p><div class="table"><a id="d0e13135"/><p class="title"><b>Table 15.13. Security Events</b></p><div class="table-contents"><table summary="Security Events" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">
              <p>Event Key</p>
            </th><th align="center">
              <p>Description</p>
            </th></tr></thead><tbody><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.loginSuccessful</code>
              </p>
            </td><td>
              <p>
                Raised when a login attempt is successful.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.loginFailed</code>
              </p>
            </td><td>
              <p>
                Raised when a login attempt fails.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.alreadyLoggedIn</code>
              </p>
            </td><td>
              <p>
                Raised when a user that is already authenticated attempts to log in again.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.notLoggedIn</code>
              </p>
            </td><td>
              <p>
                Raised when a security check fails when the user is not logged in.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.notAuthorized</code>
              </p>
            </td><td>
              <p>
                Raised when a security check fails when the user is logged in however doesn't have sufficient privileges.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.preAuthenticate</code>
              </p>
            </td><td>
              <p>
                Raised just prior to user authentication.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.postAuthenticate</code>
              </p>
            </td><td>
              <p>
                Raised just after user authentication.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.loggedOut</code>
              </p>
            </td><td>
              <p>
                Raised after the user has logged out.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.credentialsUpdated</code>
              </p>
            </td><td>
              <p>
                Raised when the user's credentials have been changed.
              </p>
            </td></tr><tr><td>
              <p>
                <code class="literal">org.jboss.seam.security.rememberMe</code>
              </p>
            </td><td>
              <p>
                Raised when the Identity's rememberMe property is changed.
              </p>
            </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13294"/>15.11. Run As</h2></div></div></div><p>
        Sometimes it may be necessary to perform certain operations with elevated privileges, such
        as creating a new user account as an unauthenticated user.  Seam Security supports such a
        mechanism via the <code class="literal">RunAsOperation</code> class.  This class allows either the
        <code class="literal">Principal</code> or <code class="literal">Subject</code>, or the user's roles to be
        overridden for a single set of operations.
    </p><p>
      The following code example demonstrates how <code class="literal">RunAsOperation</code> is used, by
      calling its <code class="literal">addRole()</code> method to provide a set of roles to masquerade
      as for the duration of the operation.  The <code class="literal">execute()</code> method contains the
      code that will be executed with the elevated privileges.
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RunAsOperation</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;execute</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executePrivilegedOperation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}.</span><span class="java_plain">addRole</span><span class="java_separator">(</span><span class="java_literal">&quot;admin&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">run</span><span class="java_separator">();</span></pre><p>
        In a similar way, the <code class="literal">getPrincipal()</code> or <code class="literal">getSubject()</code>
        methods can also be overriden to specify the <code class="literal">Principal</code> and 
        <code class="literal">Subject</code> instances to use for the duration of the operation.
        Finally, the <code class="literal">run()</code> method is used to carry out the 
        <code class="literal">RunAsOperation</code>.
    </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13341"/>15.12. Extending the Identity component</h2></div></div></div><p>
      Sometimes it might be necessary to extend the Identity component if your application has
      special security requirements.  The following example (contrived, as credentials would normally
      be handled by the <code class="literal">Credentials</code> component instead) shows an extended Identity 
      component with an additional <code class="literal">companyCode</code> field.  The install precedence of <code class="literal">APPLICATION</code>
      ensures that this extended Identity gets installed in preference to the built-in Identity.
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;org.jboss.seam.security.identity&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Scope</span><span class="java_separator">(</span><span class="java_plain">SESSION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Install</span><span class="java_separator">(</span><span class="java_plain">precedence&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;APPLICATION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">BypassInterceptors</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Startup</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomIdentity</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Identity</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">LogProvider</span><span class="java_plain">&nbsp;log&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Logging</span><span class="java_separator">.</span><span class="java_plain">getLogProvider</span><span class="java_separator">(</span><span class="java_type">CustomIdentity</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;companyCode</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getCompanyCode</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;companyCode</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setCompanyCode</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;companyCode</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">companyCode&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;companyCode</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;login</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log</span><span class="java_separator">.</span><span class="java_plain">info</span><span class="java_separator">(</span><span class="java_literal">&quot;######&nbsp;CUSTOM&nbsp;LOGIN&nbsp;CALLED&nbsp;######&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">.</span><span class="java_plain">login</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>
        Note that an <code class="literal">Identity</code> component must be marked <code class="literal">@Startup</code>, so that it is
        available immediately after the <code class="literal">SESSION</code> context begins.  Failing to do this may render
        certain Seam functionality inoperable in your application.
      </p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13369"/>15.13. OpenID</h2></div></div></div><p>
            OpenID is a community standard for external web-based authentication. The basic
            idea is that any web application can supplement (or replace) its local handling of
            authentication by delegating responsibility to an external OpenID server of the user's
            choose.  This benefits the user, who no longer has to remember a name and password for 
            every web application he uses, and the developer, who is relieved of some of the burden of 
            maintaining a complex authentication system.  
        </p><p>When using OpenID, the user selects an OpenID provider, and the provider assigns the user
            an OpenID.  The id will take the form of a URL, for example <code class="literal">http://maximoburrito.myopenid.com</code> however,
            it's acceptable to leave off the <code class="literal">http://</code> part of the identifier when logging into a site.  The web application
            (known as a relying party in OpenID-speak) determines which OpenID server to contact and redirects the user to the remote
            site for authentication.   Upon successful authentication the user is given
            the (cryptographically secure) token proving his identity and is redirected back to the original web application.The 
            local web application can then be sure the user accessing the application controls the OpenID he presented.
        </p><p>
            It's important to realize at this
            point that authentication does not imply authorization.  The web application still needs to make a determination of how to 
            use that information.  The web application could treat the user as instantly logged in and give full access to the system or
            it could try and map the presented OpenID to a local user account, prompting the user to register if he hasn't already.
            The choice of how to handle the OpenID is left as a design decision for the local application.  
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13384"/>15.13.1. Configuring OpenID</h3></div></div></div><p>
                Seam uses the openid4java package and requires four additional JARs to make use of the Seam integration.  These 
                are: <code class="literal">htmlparser.jar</code>, <code class="literal">openid4java.jar</code>, <code class="literal">openxri-client.jar</code> 
                and <code class="literal">openxri-syntax.jar</code>.
            </p><p>
                OpenID processing requires the use of the <code class="literal">OpenIdPhaseListener</code>, which should be added to your 
                <code class="literal">faces-config.xml</code> file.  The phase listener processes the callback from the OpenID provider, allowing
                re-entry into the local application.
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">lifecycle</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">phase-listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.security.openid.OpenIdPhaseListener</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">phase-listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">lifecycle</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
                With this configuration, OpenID support is available to your application.
                The OpenID support component, <code class="literal">org.jboss.seam.security.openid.openid</code>, is installed automatically if the openid4java
                classes are on the classpath.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13416"/>15.13.2. Presenting an OpenIdDLogin form</h3></div></div></div><p>
                 To initiate an OpenID login, you can present a simply form to the user asking for the user's OpenID.  The <code class="literal">#{openid.id}</code> 
                  value 
                 accepts the user's OpenID and the <code class="literal">#{openid.login}</code> action initiates an authentication request.
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:form</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{openid.id}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{openid.login}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;OpenID&nbsp;Login&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:form</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
                When the user submits the login form, he will be redirected to his OpenID provider. The user will eventually 
                return to your application through the Seam pseudo-view <code class="literal">/openid.xhtml</code>, which is
                provided by the <code class="literal">OpenIdPhaseListener</code>. Your application can handle the OpenID response by means 
                of a <code class="literal">pages.xml</code> navigation from that view, just as if the user had never left your application.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13440"/>15.13.3. Logging in immediately</h3></div></div></div><p> The simplest strategy is to simply login the user immediately.  The following navigation rule shows how to handle this using
        the <code class="literal">#{openid.loginImmediately()}</code> action.
    </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">page</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/openid.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">navigation</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluate</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{openid.loginImmediately()}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">if-outcome</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">redirect</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/main.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">OpenID&nbsp;login&nbsp;successful...</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">redirect</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">if-outcome</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">redirect</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">view-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/main.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">OpenID&nbsp;login&nbsp;rejected...</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">redirect</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">navigation</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">page</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>This <code class="literal">loginImmediately()</code> action checks to see if the OpenID is valid.  If it is valid, it adds an
            OpenIDPrincipal to the identity component, marks the user as logged in (i.e. <code class="literal">#{identity.loggedIn}</code> will be true)
            and returns true.  If the OpenID was not validated, the method returns false, and the user re-enters the application un-authenticated.
            If the user's OpenID is valid, it will be accessible using the expression <code class="literal">#{openid.validatedId}</code> and 
            <code class="literal">#{openid.valid}</code> will be true.
        </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13464"/>15.13.4. Deferring login</h3></div></div></div><p>
                You may not want the user to be immediately logged in to your application.  In that case, your navigation
                should check the <code class="literal">#{openid.valid}</code> property and redirect the user to a local registration or processing
                page.  Actions you might take would be asking for more information and creating a local user account or presenting a captcha 
                to avoid programmatic registrations.  When you are done processing, if you want to log the user in, you can call
                the <code class="literal">loginImmediately</code> method, either through EL as shown previously or by directly interaction with the 
                <code class="literal">org.jboss.seam.security.openid.OpenId</code> component.  Of course, nothing prevents you from writing custom 
                code to interact with the Seam identity component on your own for even more customized behaviour.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13478"/>15.13.5. Logging out</h3></div></div></div><p>
                Logging out (forgetting an OpenID association) is done by calling <code class="literal">#{openid.logout}</code>.  If you
                are not using Seam security, you can call this method directly.  If you are using Seam security, you should
                continue to use <code class="literal">#{identity.logout}</code> and install an event handler to capture the logout event, calling 
                the OpenID logout method.
                
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.seam.security.loggedOut&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">execute</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{openid.logout}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
</pre><p>It's important that you do not leave this out or the user will not be able to login again in the same session.</p></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="drools.html"><strong>Prev</strong>Chapter 14. Seam and JBoss Rules</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="i18n.html"><strong>Next</strong>Chapter 16. Internationalization, localization an...</a></li></ul></body></html>